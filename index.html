<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"caohongchuan.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":"auto","version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
<meta property="og:type" content="website">
<meta property="og:title" content="yingzheng">
<meta property="og:url" content="http://caohongchuan.github.io/index.html">
<meta property="og:site_name" content="yingzheng">
<meta property="og:description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="YingZheng">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://caohongchuan.github.io/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>yingzheng</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">yingzheng</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="YingZheng"
      src="/images/photo.png">
  <p class="site-author-name" itemprop="name">YingZheng</p>
  <div class="site-description" itemprop="description">Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/caohongchuan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;caohongchuan" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yingzhengttt@gmail.com" title="E-Mail → mailto:yingzhengttt@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/04/26/springboot/Spring%20MVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/26/springboot/Spring%20MVC/" class="post-title-link" itemprop="url">String MVC 原理详解</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-04-26 21:07:22 / Modified: 21:07:49" itemprop="dateCreated datePublished" datetime="2025-04-26T21:07:22+08:00">2025-04-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/springboot/" itemprop="url" rel="index"><span itemprop="name">springboot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/04/26/cf/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/26/cf/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B/" class="post-title-link" itemprop="url">字符串</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-04-26 11:13:36 / Modified: 20:30:26" itemprop="dateCreated datePublished" datetime="2025-04-26T11:13:36+08:00">2025-04-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/leetcode/" itemprop="url" rel="index"><span itemprop="name">leetcode</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="滑动窗口"><a href="#滑动窗口" class="headerlink" title="滑动窗口"></a>滑动窗口</h1><p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/longest-substring-without-repeating-characters/description/">无重复字符的最长子串</a></p>
<p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/longest-palindromic-substring/description/">最长回文子串</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/04/22/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/22/docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">docker 常用命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-04-22 17:25:34 / Modified: 17:26:19" itemprop="dateCreated datePublished" datetime="2025-04-22T17:25:34+08:00">2025-04-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name local-mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=yingzheng -d mysql:latest</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/04/11/springboot/SpringBoot%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/11/springboot/SpringBoot%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">SpringBoot用户管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-11 22:18:16" itemprop="dateCreated datePublished" datetime="2025-04-11T22:18:16+08:00">2025-04-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-04-21 11:29:03" itemprop="dateModified" datetime="2025-04-21T11:29:03+08:00">2025-04-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/springboot/" itemprop="url" rel="index"><span itemprop="name">springboot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="用户密码登陆"><a href="#用户密码登陆" class="headerlink" title="用户密码登陆"></a>用户密码登陆</h1><p><strong>注册</strong>：</p>
<ol>
<li>前端：用户输入用户名和密码，通过 HTTPS 发送到后端。</li>
<li>后端：验证输入，生成盐值，哈希密码，存储用户名和哈希值到数据库。</li>
<li>数据库：保存哈希值（和盐值）。</li>
<li>后端：返回注册成功响应。</li>
</ol>
<p><strong>登录</strong>：</p>
<ol>
<li>前端：发送用户名和密码（HTTPS）。</li>
<li>后端：查询数据库，验证密码哈希。</li>
<li>后端：验证通过后返回令牌，前端保存令牌用于后续请求。</li>
</ol>
<h2 id="HTTP-数据类型"><a href="#HTTP-数据类型" class="headerlink" title="HTTP 数据类型"></a>HTTP 数据类型</h2><p>在HTTP协议中，请求和响应的内容可以根据<code>Content-Type</code>头部进行分类：</p>
<h3 id="1-表单数据（Form-Data）"><a href="#1-表单数据（Form-Data）" class="headerlink" title="1. 表单数据（Form Data）"></a>1. <strong>表单数据（Form Data）</strong></h3><ul>
<li><p><strong><code>application/x-www-form-urlencoded</code></strong><br>默认的表单提交格式，数据编码为键值对（如 <code>key1=value1&amp;key2=value2</code>）。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/submit</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">name</span>=John&amp;age=<span class="number">30</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong><code>multipart/form-data</code></strong><br>用于文件上传或表单中包含二进制数据，数据分多部分</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/upload</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----boundary</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql"><span class="comment">----boundary</span></span></span><br><span class="line"><span class="language-pgsql">Content-Disposition: form-data; <span class="type">name</span>=&quot;file&quot;; filename=&quot;example.txt&quot;</span></span><br><span class="line"><span class="language-pgsql">Content-<span class="keyword">Type</span>: <span class="type">text</span>/plain</span></span><br><span class="line"><span class="language-pgsql"></span></span><br><span class="line"><span class="language-pgsql">(文件二进制数据)</span></span><br><span class="line"><span class="language-pgsql"><span class="comment">----boundary--</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="2-JSON（JavaScript-Object-Notation）"><a href="#2-JSON（JavaScript-Object-Notation）" class="headerlink" title="2. JSON（JavaScript Object Notation）"></a>2. <strong>JSON（JavaScript Object Notation）</strong></h3><ul>
<li><p><strong><code>application/json</code></strong><br>用于传输结构化JSON数据，常见于REST API。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/data</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line"><span class="language-json"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">&#125;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="3-XML（eXtensible-Markup-Language）"><a href="#3-XML（eXtensible-Markup-Language）" class="headerlink" title="3. XML（eXtensible Markup Language）"></a>3. <strong>XML（eXtensible Markup Language）</strong></h3><ul>
<li><p><strong><code>application/xml</code></strong> 或 <strong><code>text/xml</code></strong><br>用于传输XML格式数据。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/api/data</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/xml</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">name</span>&gt;</span>John<span class="tag">&lt;/<span class="name">name</span>&gt;</span><span class="tag">&lt;<span class="name">age</span>&gt;</span>30<span class="tag">&lt;/<span class="name">age</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="4-纯文本（Plain-Text）"><a href="#4-纯文本（Plain-Text）" class="headerlink" title="4. 纯文本（Plain Text）"></a>4. <strong>纯文本（Plain Text）</strong></h3><ul>
<li><p><strong><code>text/plain</code></strong><br>普通文本内容，无格式。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/log</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>text/plain</span><br><span class="line"></span><br><span class="line"><span class="language-applescript">This <span class="keyword">is</span> a <span class="built_in">log</span> message.</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="5-二进制数据（Binary-Data）"><a href="#5-二进制数据（Binary-Data）" class="headerlink" title="5. 二进制数据（Binary Data）"></a>5. <strong>二进制数据（Binary Data）</strong></h3><ul>
<li><p><strong><code>application/octet-stream</code></strong><br>未知或任意二进制数据（如文件下载）。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/octet-stream</span><br><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>attachment; filename=&quot;example.zip&quot;</span><br><span class="line"></span><br><span class="line"><span class="language-clojure">(文件二进制数据)</span></span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="6-其他常见类型"><a href="#6-其他常见类型" class="headerlink" title="6. 其他常见类型"></a>6. <strong>其他常见类型</strong></h3><ul>
<li><strong><code>application/javascript</code></strong><br>JavaScript代码。</li>
<li><strong><code>text/html</code></strong><br>HTML网页内容。</li>
<li><strong><code>image/png</code></strong>, <strong><code>image/jpeg</code></strong><br>图片资源。</li>
<li><strong><code>application/pdf</code></strong><br>PDF文档。</li>
</ul>
<p>注：关键头部字段：</p>
<ul>
<li>**<code>Content-Type</code>**：定义请求&#x2F;响应的主体类型（如 <code>Content-Type: application/json</code>）。</li>
<li>**<code>Accept</code>**：客户端声明期望的响应类型（如 <code>Accept: application/json</code>）。</li>
</ul>
<h1 id="前端处理用户信息"><a href="#前端处理用户信息" class="headerlink" title="前端处理用户信息"></a>前端处理用户信息</h1><ul>
<li>密码输入：<ul>
<li>用户在前端（如浏览器、移动端）通过表单输入密码。</li>
<li>密码字段使用 <code>&lt;input type=&quot;password&quot;&gt;</code>，避免明文显示。</li>
</ul>
</li>
<li>不存储明文：<ul>
<li>前端不保存明文密码，仅在用户提交时处理。</li>
</ul>
</li>
<li>加密传输：<ul>
<li>使用 <strong>HTTPS</strong>（TLS&#x2F;SSL）确保密码在网络传输中加密，防止中间人攻击。</li>
<li>前端将密码作为请求体的一部分（如 JSON）发送到后端。</li>
</ul>
</li>
<li>不预处理密码：<ul>
<li>前端不应对密码进行哈希或加密，直接发送明文密码（通过 HTTPS），由后端负责安全处理。哈希在前端可能导致盐值暴露或被拦截。</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Login Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">html</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">font-family</span>: Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">100vw</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background-color</span>: <span class="number">#333333</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">margin</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">height</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.login_container</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.2</span>); <span class="comment">/* 半透明背景 */</span></span></span><br><span class="line"><span class="language-css">                backdrop-<span class="attribute">filter</span>: <span class="built_in">blur</span>(<span class="number">10px</span>); <span class="comment">/* 模糊强度 */</span></span></span><br><span class="line"><span class="language-css">                <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.3</span>); <span class="comment">/* 轻边框增强效果 */</span></span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">60%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">form</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">gap</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.input_group</span> &#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">width</span>: <span class="number">100%</span>;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">flex-direction</span>: row;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">justify-content</span>: flex-end;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">gap</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;login_container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Login<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://localhost:8083/login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input_group&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span>&gt;</span>Email:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">type</span>=<span class="string">&quot;email&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">id</span>=<span class="string">&quot;email&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">name</span>=<span class="string">&quot;email&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">pattern</span>=<span class="string">&quot;[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]&#123;2,&#125;$&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">title</span>=<span class="string">&quot;输入正确邮箱地址&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">required</span></span></span><br><span class="line"><span class="tag">                    /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input_group&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>Password:<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">id</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">name</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">pattern</span>=<span class="string">&quot;(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]&#123;8,&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">title</span>=<span class="string">&quot;密码需至少8位,包含大小写字母和数字&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">required</span></span></span><br><span class="line"><span class="tag">                    /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="第三方登陆"><a href="#第三方登陆" class="headerlink" title="第三方登陆"></a>第三方登陆</h1><p>在一个 Spring Boot 应用中同时实现 <strong>OAuth2 Client</strong>（用于第三方登录，如 Google） 和 <strong>OAuth2 Authorization Server</strong>（用于生成自定义 JWT 和 Refresh Token）。</p>
<ol>
<li><strong>OAuth2 Client</strong>：处理第三方登录，获取用户 Access Token 和用户信息。</li>
<li><strong>OAuth2 Authorization Server</strong>：接收 OAuth2 Client 传递的信息，生成 JWT 和 Refresh Token，并支持 Refresh Token 刷新流程。</li>
<li><strong>整合</strong>：在一个 Spring Boot 应用中运行这两部分，确保它们协同工作。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/04/09/springboot/SpringBoot%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/09/springboot/SpringBoot%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">SpringBoot日志管理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-09 16:07:38" itemprop="dateCreated datePublished" datetime="2025-04-09T16:07:38+08:00">2025-04-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-04-10 12:12:44" itemprop="dateModified" datetime="2025-04-10T12:12:44+08:00">2025-04-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/springboot/" itemprop="url" rel="index"><span itemprop="name">springboot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>SpringBoot支持多种日志框架，包括Logback、Log4j2和Java Util Logging（JUL）。默认情况下，如果你使用SpringBoot的starters启动器，它将使用Logback作为日志框架。</p>
<ul>
<li>Logback：Logback是SpringBoot默认的日志框架，它是Log4j的继任者，提供了更好的性能和可靠性。可以通过在资源目录下创建一个logback-spring.xml文件来配置Logback。</li>
<li>Log4j2：Log4j2是Log4j的升级版，它在性能和功能上都有所提升，支持异步日志和插件机制。如果想在SpringBoot中使用Log4j2，需要添加相应的依赖并在配置文件中指定Log4j2作为日志框架。</li>
<li>Java Util Logging（JUL）：JUL是Java SE的默认日志框架，SpringBoot可以配置使用JUL作为日志框架，但一般不推荐使用，因为它的性能和灵活性相对较差。</li>
</ul>
<p>除了上述日志框架外，SpringBoot还支持SLF4J和Commons Logging这两个日志门面。这些门面可以与多种日志实现进行集成，使得你可以在不改变代码的情况下更换日志框架。</p>
<p>无论使用哪种日志框架，SpringBoot都支持配置将日志输出到控制台或者文件中。可以在application.properties或application.yml配置文件中设置日志级别、输出格式等参数。</p>
</blockquote>
<h1 id="日志门面"><a href="#日志门面" class="headerlink" title="日志门面"></a>日志门面</h1><p>在早期使用日志框架时，应用程序通常需要直接与具体的日志框架进行耦合，这就导致了以下几个问题：</p>
<ul>
<li><p>代码依赖性</p>
<p>应用程序需要直接引用具体的日志框架，从而导致代码与日志框架强耦合，难以满足应用程序对日志框架的灵活配置。</p>
</li>
<li><p>日志框架不统一</p>
<p>在使用不同的日志框架时，应用程序需要根据具体的日志框架来编写代码，这不仅会增加开发难度，而且在多种日志框架中切换时需要进行大量的代码改动。</p>
</li>
</ul>
<p>为了解决这些问题，SLF4J提供了一套通用的日志门面接口，让应用程序可以通过这些接口来记录日志信息，而不需要直接引用具体的日志框架。这样，应用程序就可以在不同的日志框架之间进行灵活配置和切换，同时还可以获得更好的性能表现。</p>
<p>依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(MyClass.class);</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;This is an info message.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果引入Lombok，可以使用lombok的注解@Slf4j 代替上面log的创建。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;This is an info message.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在SpringBoot中，<code>spring-boot-starter</code>中包含<code>spring-boot-starter-logging</code>，其中会包含<code>slf4j-api</code>依赖。</p>
<h1 id="日志实现"><a href="#日志实现" class="headerlink" title="日志实现"></a>日志实现</h1><p>Logback 和 Log4j2是目前常用的两个日志实现框架。</p>
<h2 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h2><p>Logback 的核心模块为 logback-classic，它提供了一个 SLF4J 的实现，兼容 Log4j API，可以无缝地替换 Log4j。它自身已经包含了 logback-core 模块，而 logback-core，顾名思义就是 logback 的核心功能，包括日志记录器 Appender  Layout 等。其他 logback 模块都依赖于该模块。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>logback 可以通过 XML 或者 Groovy 配置。以 XML 配置为例，logback 的 XML 配置文件名称通常为 <code>logback.xml</code> 或者 <code>logback-spring.xml</code>。在 Spring Boot 中，需要放置在 classpath 的根目录下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;30 seconds&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义通用变量 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_PATH&quot;</span> <span class="attr">value</span>=<span class="string">&quot;logs&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_FILE_NAME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5level [%thread] %logger&#123;36&#125; - %msg%n&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 控制台输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 文件输出，按日期滚动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_PATH&#125;/$&#123;LOG_FILE_NAME&#125;.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 每天滚动，历史日志文件名带日期 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;LOG_PATH&#125;/$&#123;LOG_FILE_NAME&#125;-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span> <span class="comment">&lt;!-- 保存 30 天 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span> <span class="comment">&lt;!-- 单文件最大 100MB --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 开发环境配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 生产环境配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;prod&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 默认配置（未指定 profile 时使用） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>也可以在<code>application.yml</code>或者<code>application.properties</code>中简单配置日志：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">INFO</span></span><br><span class="line">    <span class="attr">org.springframework.web:</span> <span class="string">DEBUG</span></span><br><span class="line">    <span class="attr">com.yourpackage:</span> <span class="string">DEBUG</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">myapp.log</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/var/log</span></span><br><span class="line">  <span class="attr">logback:</span></span><br><span class="line">    <span class="attr">rollingpolicy:</span></span><br><span class="line">      <span class="attr">max-file-size:</span> <span class="string">10MB</span></span><br><span class="line">      <span class="attr">max-history:</span> <span class="number">30</span></span><br></pre></td></tr></table></figure>

<p>注：如果<code>application.yml</code>和<code>logback-spring.xml</code>同时存在，<code>logback-spring.xml</code>会覆盖<code>application.yml</code></p>
<h2 id="log4j-2"><a href="#log4j-2" class="headerlink" title="log4j 2"></a>log4j 2</h2><p>The Apache Log4j SLF4J 2.0 API binding to Log4j 2 Core</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-slf4j2-impl --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j2-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.24.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;INFO&quot;</span> <span class="attr">monitorInterval</span>=<span class="string">&quot;30&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Property</span> <span class="attr">name</span>=<span class="string">&quot;logPath&quot;</span>&gt;</span>logs<span class="tag">&lt;/<span class="name">Property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;ISO8601&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">&quot;File&quot;</span> <span class="attr">fileName</span>=<span class="string">&quot;$&#123;logPath&#125;/example.log&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">filePattern</span>=<span class="string">&quot;$&#123;logPath&#125;/example-%d&#123;yyyy-MM-dd&#125;-%i.log&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;ISO8601&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">&quot;10 MB&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">DefaultRolloverStrategy</span> <span class="attr">max</span>=<span class="string">&quot;4&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">name</span>=<span class="string">&quot;com.zhanfu.child&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;File&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">name</span>=<span class="string">&quot;com.zhanfu&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;File&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">&quot;WARN&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h1><ul>
<li>TRACE：是最低级别的日志记录，用于输出最详细的调试信息，通常用于开发调试目的。在生产环境中，应该关闭 TRACE 级别的日志记录，以避免输出过多无用信息。</li>
<li>DEBUG：是用于输出程序中的一些调试信息，通常用于开发过程中。像 TRACE 一样，在生产环境中应该关闭 DEBUG 级别的日志记录。</li>
<li>INFO：用于输出程序正常运行时的一些关键信息，比如程序的启动、运行日志等。通常在生产环境中开启 INFO 级别的日志记录。</li>
<li>WARN：是用于输出一些警告信息，提示程序可能会出现一些异常或者错误。在应用程序中，WARN 级别的日志记录通常用于记录一些非致命性异常信息，以便能够及时发现并处理这些问题。</li>
<li>ERROR：是用于输出程序运行时的一些错误信息，通常表示程序出现了一些不可预料的错误。在应用程序中，ERROR 级别的日志记录通常用于记录一些致命性的异常信息，以便能够及时发现并处理这些问题。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(Main.class);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        log.trace(<span class="string">&quot;This is a Main trace message.&quot;</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;This is a Main debug message.&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;This is a Main info message.&quot;</span>);</span><br><span class="line">        log.warn(<span class="string">&quot;This is a Main warn message.&quot;</span>);</span><br><span class="line">        log.error(<span class="string">&quot;This is a Main error message.&quot;</span>);</span><br><span class="line">        Slave.main(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="SpringBoot不同开发环境"><a href="#SpringBoot不同开发环境" class="headerlink" title="SpringBoot不同开发环境"></a>SpringBoot不同开发环境</h1><ul>
<li><code>application-dev.properties</code>（开发环境）</li>
<li><code>application-test.properties</code>（测试环境）</li>
<li><code>application-prod.properties</code>（生产环境）</li>
</ul>
<p>然后在的<code>application.properties</code>或<code>application.yml</code>中指定激活的配置文件：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.properties</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p>或者在启动命令行中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar yourapp.jar --spring.profiles.active=dev</span><br></pre></td></tr></table></figure>

<p>设定好开发环境后，<code>logback-spring.xml</code>就可以根据不同的开发环境选择日志配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 开发环境配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 生产环境配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;prod&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 默认配置（未指定 profile 时使用） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;FILE&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><em>注：只有<code>logback-spring.xml</code>支持<code>&lt;springProfile&gt;</code>等命令，<code>logback.xml</code>不支持。</em></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/04/07/springboot/Spring%20Webflux%E5%8D%B3%E6%97%B6%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/07/springboot/Spring%20Webflux%E5%8D%B3%E6%97%B6%E9%80%9A%E4%BF%A1/" class="post-title-link" itemprop="url">Spring WebFlux 实现 websocket</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-07 15:33:03" itemprop="dateCreated datePublished" datetime="2025-04-07T15:33:03+08:00">2025-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-04-11 20:42:56" itemprop="dateModified" datetime="2025-04-11T20:42:56+08:00">2025-04-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="消息推送"><a href="#消息推送" class="headerlink" title="消息推送"></a>消息推送</h1><blockquote>
<p>通过一定的技术标准或协议，在互联网上通过定期传送用户需要的信息来减少信息过载。</p>
</blockquote>
<p>消息推送的实现方式：</p>
<ul>
<li><code>AJAX</code>长短轮循：客户端不断发起请求，交换数据，客户端主动。</li>
<li>基于HTTP协议的<code>SSE</code>（Server-Sent Events）技术：实现服务器向客户端实时推送数据的Web技术，服务端主动。<code>SSE</code>基于<code>HTTP协议</code>，允许服务器将数据以事件流（Event Stream）的形式发送给客户端。客户端通过建立持久的<code>HTTP连接</code>，并监听事件流，可以实时接收服务器推送的数据。前端JS通过<code>EventSource</code>结合数据。</li>
<li><code>WebSocket</code>技术：<code>WebSocket</code> 是基于 TCP 的一种新的应用层网络协议。它提供了一个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%85%A8%E5%8F%8C%E5%B7%A5&spm=1001.2101.3001.7020">全双工</a>的通道，允许服务器和客户端之间实时双向通信。</li>
<li><code>MQTT</code>通讯协议</li>
</ul>
<h2 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h2><blockquote>
<p>websocket是一个新的协议，是直接建立在TCP之上的，不基于HTTP，但握手过程中会使用HTTP。</p>
</blockquote>
<p>特点：</p>
<ul>
<li>建立在 TCP 协议之上，服务器端的实现比较容易。</li>
<li>与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。</li>
<li>数据格式比较轻量，性能开销小，通信高效。可以发送文本，也可以发送二进制数据。</li>
<li>没有同源限制，客户端可以与任意服务器通信。</li>
<li>协议标识符是ws（如果加密，则为wss），服务器网址就是 URL。</li>
</ul>
<p>应用场景：</p>
<ul>
<li>即时聊天通信</li>
<li>多玩家游戏</li>
<li>在线协同编辑&#x2F;编辑</li>
<li>实时数据流的拉取与推送</li>
<li>体育&#x2F;游戏实况</li>
<li>实时地图位置</li>
</ul>
<p>原理图：</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250411204253429.png" alt="image-20250411204253429"></p>
<p>通过wireshark分析websocket建立过程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// ---------------------------------------- 连接 -------------------------------------------</span><br><span class="line">// TCP握手</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	74	53522 → 8080 [SYN] Seq=0 Win=65495 Len=0 MSS=65495 SACK_PERM TSval=1655867669 TSecr=0 WS=128</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	74	8080 → 53522 [SYN, ACK] Seq=0 Ack=1 Win=65483 Len=0 MSS=65495 SACK_PERM TSval=1655867669 TSecr=1655867669 WS=128</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	66	53522 → 8080 [ACK] Seq=1 Ack=1 Win=65536 Len=0 TSval=1655867669 TSecr=1655867669</span><br><span class="line">//客户端发送HTTP请求携带</span><br><span class="line">127.0.0.1	127.0.0.1	HTTP	293	GET /echo HTTP/1.1 </span><br><span class="line">// ACK确认</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	66	8080 → 53522 [ACK] Seq=1 Ack=228 Win=65280 Len=0 TSval=1655867670 TSecr=1655867670</span><br><span class="line">//服务端返回告诉客户端更换协议为websocket</span><br><span class="line">127.0.0.1	127.0.0.1	HTTP	284	HTTP/1.1 101 Switching Protocols </span><br><span class="line">// ACK确认</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	66	53522 → 8080 [ACK] Seq=228 Ack=219 Win=65408 Len=0 TSval=1655867863 TSecr=1655867863</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ---------------------------------------- 数据传递 -------------------------------------------</span><br><span class="line">// 客户端发送数据</span><br><span class="line">127.0.0.1	127.0.0.1	WebSocket	84	WebSocket Text [FIN] [MASKED]</span><br><span class="line">// ACK确认</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	66	8080 → 53522 [ACK] Seq=219 Ack=246 Win=65536 Len=0 TSval=1656126026 TSecr=1656126026</span><br><span class="line">// 服务端回现数据给客户端</span><br><span class="line">127.0.0.1	127.0.0.1	WebSocket	86	WebSocket Text [FIN] </span><br><span class="line">// ACK确认</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	66	53522 → 8080 [ACK] Seq=246 Ack=239 Win=65536 Len=0 TSval=1656126034 TSecr=1656126034</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// ---------------------------------------- 关闭连接 -------------------------------------------</span><br><span class="line">// 客户端告知服务端关闭连接</span><br><span class="line">127.0.0.1	127.0.0.1	WebSocket	74	WebSocket Connection Close [FIN] [MASKED]</span><br><span class="line">// 服务端告知客户端关闭连接</span><br><span class="line">127.0.0.1	127.0.0.1	WebSocket	70	WebSocket Connection Close [FIN] </span><br><span class="line">// 客户端收到服务端断开请求并ACK确认</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	66	53522 → 8080 [ACK] Seq=254 Ack=243 Win=65536 Len=0 TSval=1656183231 TSecr=1656183231</span><br><span class="line">// 服务器发起 TCP 连接关闭，发送 FIN 包</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	66	8080 → 53522 [FIN, ACK] Seq=243 Ack=254 Win=65536 Len=0 TSval=1656183232 TSecr=1656183231</span><br><span class="line">// 客户端响应服务器的 FIN，发送自己的 FIN 包</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	66	53522 → 8080 [FIN, ACK] Seq=254 Ack=244 Win=65536 Len=0 TSval=1656183232 TSecr=1656183232</span><br><span class="line">// 服务器确认客户端的 FIN 包</span><br><span class="line">127.0.0.1	127.0.0.1	TCP	66	8080 → 53522 [ACK] Seq=244 Ack=255 Win=65536 Len=0 TSval=1656183232 TSecr=1656183232</span><br></pre></td></tr></table></figure>

<p>创建过程：</p>
<ol>
<li>三次握手建立TCP连接</li>
<li>客户端发送HTTP请求，请求升级通信协议为websocket</li>
<li>服务端发送HTTP请求，将协议升级为websocket</li>
</ol>
<p>通信过程：</p>
<ol>
<li>使用websocket协议通信</li>
</ol>
<p>关闭过程：</p>
<ol>
<li>客户端使用websocket协议告知服务端关闭连接</li>
<li>服务端使用websocket协议告知客户端关闭连接</li>
<li>完成TCP的四次挥手</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebSocketHandler <span class="title function_">echoWebSocketHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EchoWebSocketHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebSocketHandler <span class="title function_">chatWebSocketHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChatWebSocketHandler</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SimpleUrlHandlerMapping <span class="title function_">handlerMapping</span><span class="params">(WebSocketHandler echoWebSocketHandler, WebSocketHandler chatWebSocketHandler)</span> &#123;</span><br><span class="line">        Map&lt;String, WebSocketHandler&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;/echo&quot;</span>, echoWebSocketHandler);</span><br><span class="line">        map.put(<span class="string">&quot;/chat&quot;</span>, chatWebSocketHandler);</span><br><span class="line">        <span class="type">SimpleUrlHandlerMapping</span> <span class="variable">mapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleUrlHandlerMapping</span>();</span><br><span class="line">        mapping.setUrlMap(map);</span><br><span class="line">        mapping.setOrder(-<span class="number">1</span>); <span class="comment">// 优先级高于其他路由</span></span><br><span class="line">        mapping.setCorsConfigurations(Map.of(<span class="string">&quot;*&quot;</span>, <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>().applyPermitDefaultValues()));</span><br><span class="line">        <span class="keyword">return</span> mapping;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatWebSocketHandler</span> <span class="keyword">implements</span> <span class="title class_">WebSocketHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, WebSocketSession&gt; sessions = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(WebSocketSession session)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;New client connected: &#123;&#125;, Total: &#123;&#125;&quot;</span>, session.getId(), sessions.size());</span><br><span class="line">        sessions.put(session.getId(), session);</span><br><span class="line"></span><br><span class="line">        Mono&lt;Void&gt; receiveAndBrodcast = session.receive()</span><br><span class="line">                .map(WebSocketMessage::getPayloadAsText)</span><br><span class="line">                .flatMap(msg -&gt; &#123;</span><br><span class="line">                    log.info(<span class="string">&quot;Received from &#123;&#125;: &#123;&#125;&quot;</span>, session.getId(), msg);</span><br><span class="line">                    <span class="keyword">return</span> Mono.when(</span><br><span class="line">                            sessions.entrySet().stream()</span><br><span class="line">                                    .filter(entry -&gt; !entry.getKey().equals(session.getId()))</span><br><span class="line">                                    .map(entry -&gt; &#123;</span><br><span class="line">                                        <span class="type">WebSocketSession</span> <span class="variable">targetSession</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">                                        <span class="keyword">return</span> targetSession.send(</span><br><span class="line">                                                Mono.just(targetSession.textMessage(<span class="string">&quot;Broadcast: &quot;</span> + msg))</span><br><span class="line">                                        );</span><br><span class="line">                                    &#125;)</span><br><span class="line">                                    .toList()</span><br><span class="line">                    );</span><br><span class="line">                &#125;)</span><br><span class="line">                .doOnError(err -&gt; log.error(<span class="string">&quot;Error in session &#123;&#125;: &#123;&#125;&quot;</span>, session.getId(), err.getMessage()))</span><br><span class="line">                .then();</span><br><span class="line"></span><br><span class="line">        Mono&lt;Void&gt; sendWelcome = session.send(</span><br><span class="line">                Mono.just(session.textMessage(<span class="string">&quot;Welcome to broadcast chat!&quot;</span>))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Mono.when(sendWelcome, receiveAndBrodcast)</span><br><span class="line">                .doFinally(signal -&gt; &#123;</span><br><span class="line">                    sessions.remove(session.getId());</span><br><span class="line">                    log.info(<span class="string">&quot;Client disconnect: &#123;&#125;, Total: &#123;&#125;&quot;</span>, session.getId(), sessions.size());</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EchoWebSocketHandler</span> <span class="keyword">implements</span> <span class="title class_">WebSocketHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Mono&lt;Void&gt; <span class="title function_">handle</span><span class="params">(WebSocketSession session)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> session.send(</span><br><span class="line">                session.receive()</span><br><span class="line">                        .map(msg -&gt; &#123;</span><br><span class="line">                            log.info(<span class="string">&quot;Received: &#123;&#125;&quot;</span>, msg.getPayloadAsText());</span><br><span class="line">                            <span class="keyword">return</span> session.textMessage(<span class="string">&quot;Echo: &quot;</span> + msg.getPayloadAsText());</span><br><span class="line">                        &#125;)</span><br><span class="line">                        .doOnError(e -&gt; System.err.println(<span class="string">&quot;Error: &quot;</span> + e.getMessage()))</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/04/06/interview/Java%20IO%E9%9D%A2%E8%AF%95%E5%90%88%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/06/interview/Java%20IO%E9%9D%A2%E8%AF%95%E5%90%88%E9%9B%86/" class="post-title-link" itemprop="url">Java IO面试合集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-06 10:30:58" itemprop="dateCreated datePublished" datetime="2025-04-06T10:30:58+08:00">2025-04-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-04-07 15:08:04" itemprop="dateModified" datetime="2025-04-07T15:08:04+08:00">2025-04-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="IO流（BIO）"><a href="#IO流（BIO）" class="headerlink" title="IO流（BIO）"></a>IO流（BIO）</h1><p>根据数据传输方式，可以将 IO 类分为:</p>
<ul>
<li><p><strong>字节流</strong>：字节流读取单个字节，字节流用来处理二进制文件(图片、MP3、视频文件)。</p>
<img src="https://pdai.tech/images/io/java-io-category-1.png" style="zoom: 80%;" />
</li>
<li><p><strong>字符流</strong>：字符流读取单个字符(一个字符根据编码的不同，对应的字节也不同，如 UTF-8 编码中文汉字是 3 个字节，GBK编码中文汉字是 2 个字节。)，字符流用来处理文本文件(可以看做是特殊的二进制文件，使用了某种编码，人可以阅读)。</p>
<img src="https://pdai.tech/images/io/java-io-category-2.png" style="zoom: 80%;" /></li>
</ul>
<p>根据数据操作对象，可以将 IO 类分为:</p>
<img src="https://pdai.tech/images/io/java-io-category-3.png" style="zoom:80%;" />

<h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><blockquote>
<p><strong>装饰者模式（Decorator）</strong>：把装饰者套在被装饰者之上，从而动态扩展被装饰者的功能，装饰器模式通过<strong>组合</strong>替代继承来扩展原始类的功能。即可以在不改变原有对象的情况下拓展其功能。</p>
</blockquote>
<img src="https://pdai.tech/images/pics/DP-Decorator-java.io.png" style="zoom:80%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BufferedInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(fileName));</span><br><span class="line"><span class="type">ZipInputStream</span> <span class="variable">zis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipInputStream</span>(bis);</span><br><span class="line"></span><br><span class="line"><span class="type">BufferedOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(fileName));</span><br><span class="line"><span class="type">ZipOutputStream</span> <span class="variable">zipOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipOutputStream</span>(bos);</span><br></pre></td></tr></table></figure>

<h1 id="操作系统IO模型"><a href="#操作系统IO模型" class="headerlink" title="操作系统IO模型"></a>操作系统IO模型</h1><p>异步IO</p>
<table>
<thead>
<tr>
<th></th>
<th>Linux</th>
<th>MacOS</th>
<th>Window</th>
</tr>
</thead>
<tbody><tr>
<td>事件驱动IO</td>
<td><code>select</code> <code>poll</code> <code>epoll</code></td>
<td><code>kqueue</code></td>
<td>无</td>
</tr>
<tr>
<td>异步IO</td>
<td><code>POSIX</code><br /><code>io_uring</code> (kernel5.1+)</td>
<td>无</td>
<td><code>IOCP</code></td>
</tr>
</tbody></table>
<p>事件驱动IO &#x2F; IO多路复用</p>
<table>
<thead>
<tr>
<th>IO模型</th>
<th>相对性能</th>
<th>关键思路</th>
<th>操作系统</th>
<th>JAVA支持情况</th>
</tr>
</thead>
<tbody><tr>
<td><code>select</code></td>
<td>较高</td>
<td>Reactor</td>
<td>windows&#x2F;Linux</td>
<td>支持,Reactor模式(反应器设计模式)。Linux操作系统的 kernels 2.4内核版本之前，默认使用select；而目前windows下对同步IO的支持，都是select模型</td>
</tr>
<tr>
<td><code>poll</code></td>
<td>较高</td>
<td>Reactor</td>
<td>Linux</td>
<td>Linux下的JAVA NIO框架，Linux kernels 2.6内核版本之前使用poll进行支持。也是使用的Reactor模式</td>
</tr>
<tr>
<td><code>epoll</code></td>
<td>高</td>
<td>Reactor&#x2F;Proactor</td>
<td>Linux</td>
<td>Linux kernels 2.6内核版本及以后使用epoll进行支持；Linux kernels 2.6内核版本之前使用poll进行支持；另外一定注意，由于Linux下没有Windows下的IOCP技术提供真正的 异步IO 支持，所以Linux下使用epoll模拟异步IO</td>
</tr>
<tr>
<td><code>kqueue</code></td>
<td>高</td>
<td>Proactor</td>
<td>FreeBSD&#x2F;MacOS</td>
<td>目前JAVA的版本不支持</td>
</tr>
</tbody></table>
<h1 id="Java-IO模型"><a href="#Java-IO模型" class="headerlink" title="Java IO模型"></a>Java IO模型</h1><h2 id="BIO-Blocking-I-O"><a href="#BIO-Blocking-I-O" class="headerlink" title="BIO (Blocking I&#x2F;O)"></a>BIO (Blocking I&#x2F;O)</h2><p>BIO 属于同步阻塞 IO 模型，同步阻塞 IO 模型中，应用程序发起 read 调用后，会一直阻塞，直到内核把数据拷贝到用户空间。在客户端连接数量不高的情况下，是没问题的。但是，当面对十万甚至百万级连接的时候，传统的 BIO 模型是无能为力的。因此，我们需要一种更高效的 I&#x2F;O 处理模型来应对更高的并发量。</p>
<h2 id="NIO-Non-blocking-New-I-O"><a href="#NIO-Non-blocking-New-I-O" class="headerlink" title="NIO (Non-blocking&#x2F;New I&#x2F;O)"></a>NIO (Non-blocking&#x2F;New I&#x2F;O)</h2><p>Java 中的 NIO 于 Java 1.4 中引入，对应 <code>java.nio</code> 包，提供了 <code>Channel</code> , <code>Selector</code>，<code>Buffer</code> 等抽象。它是支持面向缓冲的，基于通道的 I&#x2F;O 操作方法。 对于高负载、高并发的（网络）应用，应使用 NIO。</p>
<p>Java 异步 I&#x2F;O 机制：</p>
<ul>
<li>NIO（java.nio）：<ul>
<li>引入了非阻塞 I&#x2F;O 和选择器（Selector），基于操作系统的多路复用机制（如 Linux 的 <code>select</code> <code>poll</code> <code>epoll</code>）。</li>
<li>通过 Selector 和 Channel（如 <code>SocketChannel</code> <code>ServerSocketChannel</code> <code>DatagramChannel</code>），Java 可以实现高效的网络 I&#x2F;O。</li>
<li>但这是 就绪通知（readiness-based）模型，而不是真正的完成型异步 I&#x2F;O。</li>
</ul>
</li>
<li>NIO.2（Asynchronous I&#x2F;O，Java 7+）：<ul>
<li>在 java.nio.channels 包中提供了异步通道类，如 <code>AsynchronousSocketChannel</code> <code>AsynchronousFileChannel</code></li>
<li>支持通过 Future 或回调（CompletionHandler）处理 I&#x2F;O 操作的结果。</li>
<li>底层实现依赖操作系统的异步 I&#x2F;O 接口：<ul>
<li>在 Linux 上，<code>AsynchronousFileChannel</code> 使用 <code>POSIX AIO</code> 作为其底层实现机制。<code>AsynchronousSocketChannel</code> 使用 <code>epoll</code></li>
<li>在 Windows 上，使用 IOCP（I&#x2F;O Completion Ports）。</li>
<li>在 macOS 上，使用线程池或 kqueue。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Java 原生提供的NIO过于底层，编写复杂度很高，不推荐程序员直接使用，可以通过Netty框架来进行网络编程。</p>
<h2 id="AIO-Asynchronous-I-O"><a href="#AIO-Asynchronous-I-O" class="headerlink" title="AIO (Asynchronous I&#x2F;O)"></a>AIO (Asynchronous I&#x2F;O)</h2><p>Java</p>
<ul>
<li><p>在Window上使用IOCP，是完全异步的模型。</p>
</li>
<li><p>在Linux和BSD中 <code>AsynchronousFileChannel</code> 使用 <code>POSIX AIO</code> 作为其底层实现机制是完全异步的操作，但<code>AsynchronousSocketChannel</code> 使用 <code>epoll</code> 加线程池模拟异步行为。</p>
</li>
</ul>
<p>目前Java还没有支持Linux的 <code>io_uring</code> 完全异步IO模型。项目中直接使用AIO的情景很少，主要还是使用NIO，如Netty。</p>
<p>总结：目前主流的Socket IO基本上使用NIO（事件驱动IO），需要自行编写网络IO可使用Netty，需要使用Spring就使用Spring WebFlux（对Netty封装）</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/04/04/interview/Spring%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8BAOP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/04/interview/Spring%E9%9D%A2%E5%90%91%E5%88%87%E9%9D%A2%E7%BC%96%E7%A8%8BAOP/" class="post-title-link" itemprop="url">Spring面向切面编程(AOP)</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-04 08:20:21" itemprop="dateCreated datePublished" datetime="2025-04-04T08:20:21+08:00">2025-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-04-05 13:44:28" itemprop="dateModified" datetime="2025-04-05T13:44:28+08:00">2025-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="面向切面编程-AOP-VS-面向对象编程（OOP）"><a href="#面向切面编程-AOP-VS-面向对象编程（OOP）" class="headerlink" title="面向切面编程(AOP) VS 面向对象编程（OOP）"></a>面向切面编程(AOP) VS 面向对象编程（OOP）</h1><blockquote>
<p>OOP面向对象编程，针对业务处理过程的实体及其属性和行为进行抽象封装，以获得更加清晰高效的逻辑单元划分。而AOP则是针对业务处理过程中的切面进行提取，它所面对的是处理过程的某个步骤或阶段，以获得逻辑过程的中各部分之间低耦合的隔离效果。</p>
<ul>
<li>OOP：从纵向解决代码重复问题</li>
<li>AOP：从横向解决代码重复问题，取代了传统从纵向继承体系重复代码（性能监控、事务管理、缓存，日志等）将业务逻辑与系统处理代码进行解耦。</li>
</ul>
</blockquote>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250404085620522.png" alt="image-20250404085620522"></p>
<p>图左结构为正常AOP架构，日志处理会被加入到每一个方法中。图右结构为AOP架构，日志处理会被抽离出来，方法中不需要处理日志，会被AOP以切面的形式添加到每个方法开始之前。</p>
<ul>
<li><p><strong>连接点（Jointpoint）</strong>：表示需要在程序中插入横切关注点的扩展点，<strong>连接点可能是类初始化、方法执行、方法调用、字段调用或处理异常等等</strong>，<em>Spring只支持方法执行连接点</em>，在AOP中表示为<strong>在哪里干</strong>；</p>
</li>
<li><p><strong>切入点（Pointcut）</strong>： 选择一组相关连接点的模式，即可以认为连接点的集合，Spring支持perl5正则表达式和AspectJ切入点模式，Spring默认使用AspectJ语法，在AOP中表示为<strong>在哪里干的集合</strong>；</p>
</li>
<li><p><strong>通知（Advice）</strong>：在连接点上执行的行为，通知提供了在AOP中需要在切入点所选择的连接点处进行扩展现有行为的手段；包括前置通知（before advice）、后置通知(after advice)、环绕通知（around advice），在Spring中通过代理模式实现AOP，并通过拦截器模式以环绕连接点的拦截器链织入通知；在AOP中表示为<strong>干什么</strong>。</p>
</li>
<li><p><strong>切面（Aspect）</strong>：横切关注点的模块化，比如上边提到的日志组件。可以认为是通知和切入点的组合；在Spring中可以使用Schema和@AspectJ方式进行组织实现；在AOP中表示为<strong>在哪干和干什么集合</strong>。</p>
</li>
</ul>
<h1 id="Spring-AOP和AspectJ"><a href="#Spring-AOP和AspectJ" class="headerlink" title="Spring AOP和AspectJ"></a>Spring AOP和AspectJ</h1><blockquote>
<p>AspectJ是一个Java实现的AOP框架，它能够对Java代码进行AOP编译（一般在编译期进行），让Java代码具有AspectJ的AOP功能（需要特殊的编译器）</p>
</blockquote>
<blockquote>
<p>Spring 框架通过定义切面, 通过拦截切点实现了不同业务模块的解耦，这个就叫**面向切面编程 - Aspect Oriented Programming (AOP)**。</p>
<p>AOP的本质也是为了解耦，通过<strong>预编译方式</strong>和<strong>运行期间动态代理</strong>实现程序的统一维护的一种技术。</p>
</blockquote>
<p>区别：</p>
<ul>
<li><p>AspectJ是更强的AOP框架，是实际意义的<strong>AOP标准</strong>；</p>
</li>
<li><p>Spring AOP使用纯Java实现, 它不需要专门的编译过程, 它一个<strong>重要的原则就是无侵入性（non-invasiveness）</strong>。</p>
</li>
<li><p>Spring小组喜欢@AspectJ注解风格更胜于Spring XML配置，在Spring 2.0使用了和AspectJ 5一样的注解，并使用AspectJ来做切入点解析和匹配。<strong>但是，AOP在运行时仍旧是纯的Spring AOP，并不依赖于AspectJ的编译器或者织入器（weaver）</strong>。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Spring AOP</th>
<th>AspectJ</th>
</tr>
</thead>
<tbody><tr>
<td>在纯 Java 中实现</td>
<td>使用 Java 编程语言的扩展实现</td>
</tr>
<tr>
<td>不需要单独的编译过程</td>
<td>除非设置 LTW，否则需要 AspectJ 编译器 (ajc)</td>
</tr>
<tr>
<td>只能使用运行时织入</td>
<td>运行时织入不可用。支持编译时、编译后和加载时织入</td>
</tr>
<tr>
<td>功能不强-仅支持方法级编织</td>
<td>更强大 - 可以编织字段、方法、构造函数、静态初始值设定项、最终类&#x2F;方法等</td>
</tr>
<tr>
<td>只能在由 Spring 容器管理的 bean 上实现</td>
<td>可以在所有域对象上实现</td>
</tr>
<tr>
<td>仅支持方法执行切入点</td>
<td>支持所有切入点</td>
</tr>
<tr>
<td>代理是由目标对象创建的, 并且切面应用在这些代理上</td>
<td>在执行应用程序之前 (在运行时) 前, 各方面直接在代码中进行织入</td>
</tr>
<tr>
<td>比 AspectJ 慢多了</td>
<td>更好的性能</td>
</tr>
<tr>
<td>易于学习和应用</td>
<td>相对于 Spring AOP 来说更复杂</td>
</tr>
</tbody></table>
<p>织入器（weaver）：织入分为动态织入和静态织入，织入可以理解为将切面应用到目标函数中，即定义切面后，需要将切面织入到目标代码内。</p>
<ul>
<li><p><strong>动态织入</strong>的方式是在运行时动态将要增强的代码织入到目标类中，这样往往是通过动态代理技术完成的，如Java JDK的动态代理(Proxy，底层通过反射实现)或者CGLIB的动态代理(底层通过继承实现)，Spring AOP采用的就是基于运行时增强的代理技术</p>
</li>
<li><p>ApectJ采用的就是<strong>静态织入</strong>的方式。ApectJ主要采用的是编译期织入，在这个期间使用AspectJ的acj编译器(类似javac)把aspect类编译成class字节码后，在java目标类编译时织入，即先编译aspect类再编译目标类。</p>
</li>
</ul>
<h1 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h1><blockquote>
<p>Spring AOP 支持对XML模式和基于@AspectJ注解的两种配置方式。</p>
</blockquote>
<h2 id="XML模式"><a href="#XML模式" class="headerlink" title="XML模式"></a>XML模式</h2><p>定义业务实现类<code>xxxServiceImpl.java</code>，定义切面类<code>xxxAspect.java</code>，编写XML配置文件<code>xxx.xml</code>。将业务实现类和切面类注册为bean，然后配置切面（切面中包含切入点和通知类型）。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;tech.pdai.springframework&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 目标类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- configure properties of bean here as normal --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 切面 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- configure properties of aspect here as normal --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置切面 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置切入点 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointCutMethod&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* xxx.service.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 环绕通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;doAround&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCutMethod&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 前置通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;doBefore&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCutMethod&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 后置通知；returning属性：用于设置后置通知的第二个参数的名称，类型是Object --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;doAfterReturning&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCutMethod&quot;</span> <span class="attr">returning</span>=<span class="string">&quot;result&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 异常通知：如果没有异常，将不会执行增强；throwing属性：用于设置通知第二个参数的的名称、类型--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;doAfterThrowing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCutMethod&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;e&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 最终通知 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;doAfter&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCutMethod&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Spring-AOP注解"><a href="#Spring-AOP注解" class="headerlink" title="Spring AOP注解"></a>Spring AOP注解</h2><table>
<thead>
<tr>
<th>注解名称</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>@Aspect</td>
<td>用来定义一个切面。</td>
</tr>
<tr>
<td>@pointcut</td>
<td>用于定义切入点表达式。在使用时还需要定义一个包含名字和任意参数的方法签名来表示切入点名称，这个方法签名就是一个返回值为void，且方法体为空的普通方法。</td>
</tr>
<tr>
<td>@Before</td>
<td>用于定义前置通知，相当于BeforeAdvice。在使用时，通常需要指定一个value属性值，该属性值用于指定一个切入点表达式(可以是已有的切入点，也可以直接定义切入点表达式)。</td>
</tr>
<tr>
<td>@AfterReturning</td>
<td>用于定义后置通知，相当于AfterReturningAdvice。在使用时可以指定pointcut &#x2F; value和returning属性，其中pointcut &#x2F; value这两个属性的作用一样，都用于指定切入点表达式。</td>
</tr>
<tr>
<td>@Around</td>
<td>用于定义环绕通知，相当于MethodInterceptor。在使用时需要指定一个value属性，该属性用于指定该通知被植入的切入点。</td>
</tr>
<tr>
<td>@After-Throwing</td>
<td>用于定义异常通知来处理程序中未处理的异常，相当于ThrowAdvice。在使用时可指定pointcut &#x2F; value和throwing属性。其中pointcut&#x2F;value用于指定切入点表达式，而throwing属性值用于指定-一个形参名来表示Advice方法中可定义与此同名的形参，该形参可用于访问目标方法抛出的异常。</td>
</tr>
<tr>
<td>@After</td>
<td>用于定义最终final 通知，不管是否异常，该通知都会执行。使用时需要指定一个value属性，该属性用于指定该通知被植入的切入点。</td>
</tr>
<tr>
<td>@DeclareParents</td>
<td>用于定义引介通知，相当于IntroductionInterceptor。</td>
</tr>
</tbody></table>
<h2 id="定义日志注解"><a href="#定义日志注解" class="headerlink" title="定义日志注解"></a>定义日志注解</h2><p>首先定义一个日志注解，该注解用来标记需要被切面处理的方法上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Loggable &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定义切面"><a href="#定义切面" class="headerlink" title="定义切面"></a>定义切面</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(top.chc.aspectdemo.aspect.Loggable)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loggable</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;loggable()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before the method is called&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<strong>切入点</strong>是注解<code>Loggable</code>，然后通过<code>@Before @After</code>等注解定义<strong>通知</strong>。</p>
<h2 id="放置注解"><a href="#放置注解" class="headerlink" title="放置注解"></a>放置注解</h2><p>将注解放置到业务代码中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line">    <span class="meta">@Loggable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getUser</span><span class="params">(String name)</span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;User name: %s\n&quot;</span>, name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种方式是侵入式的，会在业务代码中添加了<code>@Loggable</code>注解。</p>
<p>可以在定义切面的时候，直接将切入点定义到具体的业务类方法上，而不是注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LogAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义切点（这里以controller包下的所有方法为例）</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.example.controller..*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logPointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前置通知：在方法执行前记录日志</span></span><br><span class="line">    <span class="meta">@Before(&quot;logPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logBefore</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> joinPoint.getTarget().getClass().getSimpleName();</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">&quot;方法开始执行: &#123;&#125;.&#123;&#125;&quot;</span>, className, methodName);</span><br><span class="line">        logger.info(<span class="string">&quot;入参: &#123;&#125;&quot;</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后置通知：在方法执行后记录日志</span></span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;logPointcut()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logAfterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> joinPoint.getTarget().getClass().getSimpleName();</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">&quot;方法执行结束: &#123;&#125;.&#123;&#125;&quot;</span>, className, methodName);</span><br><span class="line">        logger.info(<span class="string">&quot;返回结果: &#123;&#125;&quot;</span>, result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 异常通知：在方法抛出异常时记录日志</span></span><br><span class="line">    <span class="meta">@AfterThrowing(pointcut = &quot;logPointcut()&quot;, throwing = &quot;exception&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logAfterThrowing</span><span class="params">(JoinPoint joinPoint, Throwable exception)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> joinPoint.getTarget().getClass().getSimpleName();</span><br><span class="line">        </span><br><span class="line">        logger.error(<span class="string">&quot;方法执行异常: &#123;&#125;.&#123;&#125;&quot;</span>, className, methodName);</span><br><span class="line">        logger.error(<span class="string">&quot;异常信息: &quot;</span>, exception);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 环绕通知：可以控制方法执行的整个过程</span></span><br><span class="line">    <span class="meta">@Around(&quot;logPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 执行目标方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">timeCost</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> joinPoint.getTarget().getClass().getSimpleName();</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">&quot;方法: &#123;&#125;.&#123;&#125; 执行耗时: &#123;&#125;ms&quot;</span>, className, methodName, timeCost);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Pointcut</code>：定义切入点，可以使用不同的表达式</p>
<ul>
<li><code>execution(* com.example..*.*(..))</code>：匹配指定包下的所有方法</li>
<li><code>within(com.example.controller.*)</code>：匹配指定包下的所有类</li>
<li><code>@annotation(com.example.annotation.Log)</code>：匹配带有特定注解的方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 任意公共方法的执行：</span></span><br><span class="line">execution（<span class="keyword">public</span> * *（..））</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任何一个名字以“set”开始的方法的执行：</span></span><br><span class="line">execution（* set*（..））</span><br><span class="line"></span><br><span class="line"><span class="comment">// AccountService接口定义的任意方法的执行：</span></span><br><span class="line">execution（* com.xyz.service.AccountService.*（..））</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在service包中定义的任意方法的执行：</span></span><br><span class="line">execution（* com.xyz.service.*.*（..））</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在service包或其子包中定义的任意方法的执行：</span></span><br><span class="line">execution（* com.xyz.service..*.*（..））</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在service包中的任意连接点（在Spring AOP中只是方法执行）：</span></span><br><span class="line">within（com.xyz.service.*）</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在service包或其子包中的任意连接点（在Spring AOP中只是方法执行）：</span></span><br><span class="line">within（com.xyz.service..*）</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现了AccountService接口的代理对象的任意连接点 （在Spring AOP中只是方法执行）：</span></span><br><span class="line"><span class="built_in">this</span>（com.xyz.service.AccountService）<span class="comment">// &#x27;this&#x27;在绑定表单中更加常用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现AccountService接口的目标对象的任意连接点 （在Spring AOP中只是方法执行）：</span></span><br><span class="line">target（com.xyz.service.AccountService） <span class="comment">// &#x27;target&#x27;在绑定表单中更加常用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 任何一个只接受一个参数，并且运行时所传入的参数是Serializable 接口的连接点（在Spring AOP中只是方法执行）</span></span><br><span class="line">args（java.io.Serializable） <span class="comment">// &#x27;args&#x27;在绑定表单中更加常用; 请注意在例子中给出的切入点不同于 execution(* *(java.io.Serializable))： args版本只有在动态运行时候传入参数是Serializable时才匹配，而execution版本在方法签名中声明只有一个 Serializable类型的参数时候匹配。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标对象中有一个 @Transactional 注解的任意连接点 （在Spring AOP中只是方法执行）</span></span><br><span class="line"><span class="meta">@target</span>（org.springframework.transaction.annotation.Transactional）<span class="comment">// &#x27;@target&#x27;在绑定表单中更加常用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 任何一个目标对象声明的类型有一个 @Transactional 注解的连接点 （在Spring AOP中只是方法执行）：</span></span><br><span class="line"><span class="meta">@within</span>（org.springframework.transaction.annotation.Transactional） <span class="comment">// &#x27;@within&#x27;在绑定表单中更加常用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 任何一个执行的方法有一个 @Transactional 注解的连接点 （在Spring AOP中只是方法执行）</span></span><br><span class="line"><span class="meta">@annotation</span>（org.springframework.transaction.annotation.Transactional） <span class="comment">// &#x27;@annotation&#x27;在绑定表单中更加常用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 任何一个只接受一个参数，并且运行时所传入的参数类型具有@Classified 注解的连接点（在Spring AOP中只是方法执行）</span></span><br><span class="line"><span class="meta">@args</span>（com.xyz.security.Classified） <span class="comment">// &#x27;@args&#x27;在绑定表单中更加常用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 任何一个在名为&#x27;tradeService&#x27;的Spring bean之上的连接点 （在Spring AOP中只是方法执行）</span></span><br><span class="line">bean（tradeService）</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任何一个在名字匹配通配符表达式&#x27;*Service&#x27;的Spring bean之上的连接点 （在Spring AOP中只是方法执行）</span></span><br><span class="line">bean（*Service）</span><br><span class="line">    </span><br><span class="line"><span class="comment">// &amp;&amp;：要求连接点同时匹配两个切入点表达式</span></span><br><span class="line"><span class="comment">// ||：要求连接点匹配任意个切入点表达式</span></span><br><span class="line"><span class="comment">// !:：要求连接点不匹配指定的切入点表达式</span></span><br></pre></td></tr></table></figure>

<p>总结：</p>
<ul>
<li>Spring AOP比完全使用AspectJ更加简单， 因为它不需要引入AspectJ的编译器&#x2F;织入器到你开发和构建过程中。 如果你<strong>仅仅需要在Spring bean上通知执行操作，那么Spring AOP是合适的选择</strong>。</li>
<li>如果你需要通知domain对象或其它没有在Spring容器中管理的任意对象，那么你需要使用AspectJ。</li>
<li>如果你想通知除了简单的方法执行之外的连接点（调用连接点、字段get或set的连接点等等）， 也需要使用AspectJ。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/04/02/cf/%E6%A0%91%E7%BB%93%E6%9E%84/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/02/cf/%E6%A0%91%E7%BB%93%E6%9E%84/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/" class="post-title-link" itemprop="url">二叉搜索树</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-04-02 16:35:56" itemprop="dateCreated datePublished" datetime="2025-04-02T16:35:56+08:00">2025-04-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-05-11 23:49:20" itemprop="dateModified" datetime="2025-05-11T23:49:20+08:00">2025-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/data-structure/" itemprop="url" rel="index"><span itemprop="name">data_structure</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>[TOC]</p>
<h1 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h1><blockquote>
<p>红黑树的定义：</p>
<ul>
<li>每个节点为红色或黑色。</li>
<li>根节点始终为黑色。</li>
<li>红色节点的子节点必须为黑色（无连续红色节点）。</li>
<li>从根到每个叶节点（NIL节点）的黑色节点数量（黑色高度）相等。</li>
<li>所有叶节点（NIL节点）为黑色。</li>
</ul>
</blockquote>
<p>通过红黑树的定义，可确保<strong>其没有一条路径长度能够超出其他路径的2倍</strong>。 通过下图可知，因为需要保证<strong>从根到每个叶节点的黑色节点数量（黑色高度）相等，</strong>所以左侧为<code>black -&gt; red -&gt; black -&gt; red -&gt; black -&gt; null</code> 右侧为<code>black -&gt; black -&gt; black -&gt; null</code>从根节点到NIL节点（图中标为NULL）都只有三个，两者高度相差相差是小于2倍的。</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250508203425141.png" alt="image-20250508203425141"></p>
<p>红黑树控制了最长路径和最短路径之比，间接地使红黑树达到了“近似平衡”，增删查改地时间消耗不会过大，并且相比AVL树，旋转调整次数会更少。</p>
<h2 id="红黑树节点的数据结构"><a href="#红黑树节点的数据结构" class="headerlink" title="红黑树节点的数据结构"></a>红黑树节点的数据结构</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RBNode</span>&lt;K <span class="keyword">extends</span> <span class="title class_">Comparable</span>&lt;K&gt;, V&gt; &#123;</span><br><span class="line">    K key;</span><br><span class="line">    V value;</span><br><span class="line">    RBNode&lt;K, V&gt; parent, leftChild, rightChild;</span><br><span class="line">    <span class="type">boolean</span> isRed;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RBNode</span><span class="params">(K key, V value, RBNode&lt;K, V&gt; leftChild, RBNode&lt;K, V&gt; rightChild, RBNode&lt;K, V&gt; parent, <span class="type">boolean</span> isRed)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">        <span class="built_in">this</span>.leftChild = leftChild;</span><br><span class="line">        <span class="built_in">this</span>.rightChild = rightChild;</span><br><span class="line">        <span class="built_in">this</span>.parent = parent;</span><br><span class="line">        <span class="built_in">this</span>.isRed = isRed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="红黑树的插入"><a href="#红黑树的插入" class="headerlink" title="红黑树的插入"></a>红黑树的插入</h2><ol>
<li>首先按照二叉搜索树的插入规则确定插入节点的位置。</li>
<li>插入新节点，初始化节点颜色为红色。</li>
<li>为保持红黑树的性质，需要对原有树结构进行<strong>平衡调整</strong>。</li>
</ol>
<h2 id="红黑树的删除"><a href="#红黑树的删除" class="headerlink" title="红黑树的删除"></a>红黑树的删除</h2><p>首先要明确几个概念：</p>
<p>1.<strong>约定(NIL)是黑色，也可以作为实际节点的儿子。</strong></p>
<p>旋转操作 包括<strong>左旋</strong>和<strong>右旋</strong></p>
<p>2.<strong>左旋</strong>：</p>
<p>本文以(cur)为基点进行旋转（有些文章是以(p)为基点）</p>
<p>算法：</p>
<ol>
<li>记录节点(p)的父节点(g)（如果有），图中并为标出</li>
<li>将节点(curl)移至节点(p)的右儿子</li>
<li>将节点(p)移至节点(cur)的左儿子</li>
<li>将节点(cur)移至节点(g)的儿子指向，（如果节点(p)有父节点(g)）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511120425567.png" alt="image-20250511120425567"></p>
<p>3.<strong>右旋：</strong></p>
<p>本文以(cur)为基点进行旋转（有些文章是以(p)为基点）</p>
<p>算法：</p>
<ol>
<li>记录节点(p)的父节点(g)（如果有），图中并为标出</li>
<li>将节点(curr)移至节点(p)的左儿子</li>
<li>将节点(p)移至节点(cur)的右儿子</li>
<li>将节点(cur)移至节点(g)的儿子指向，（如果节点(p)有父节点(g)）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511120419480.png" alt="image-20250511120419480"></p>
<p>4.<strong>删除节点</strong></p>
<p>针对删除操作，不同的文章有不同的标准，有<strong>直接删除节点</strong>的，有定义<strong>双黑节点</strong>的。本文会结合两者。</p>
<p>为了更直观的观察节点的删除情况，本文以直接删除节点的情况来绘图，但删除过程中有一种情况需要递归向上的平衡子树，所以在递归的情况下，使用双黑节点。无论使用直接删除节点还是双黑节点，两者的原理是相同的。</p>
<p><em>代码实现中：在寻找到删除节点后（该节点是经过移动后最终的删除节点没有儿子的情况）便立刻用(NIL)替代删除节点，后续判断过程中无论是最底层节点的直接删除，还是递归向上平衡子树都不需要再次删除了，即相当于使用的是双黑节点的思路，即双黑节点的内容是删除后的最后结果，不需要再操作了，只需要平衡该节点即可。</em></p>
<p>下图中要删除的节点是(cur)：</p>
<ul>
<li>若(cur)没有子节点则它的两个儿子都是NIL节点，删除后需要用(NIL)替代。右上子树是其双黑节点的表示形式</li>
<li>若(cur)有子节点，这种情况只出现在<strong>递归向上平衡子树</strong>的情况中，该情况在图中用<strong>双黑节点</strong>表示，但是旋转变色过程与<strong>直接删除节点</strong>的情况是一样的。右下子树是其双黑节点的表现形式。</li>
</ul>
<p>这三种表现形式都是一样的，都是以(cur)节点为根的子树内部的不同表现形式，并不会影响到(p)以及上面的节点。</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511141844943.png" alt="image-20250511141844943"></p>
<p><strong>5.图标</strong></p>
<p>黑圆代表黑色节点，红圆代表红色节点，虚线圆代表红或者黑节点。</p>
<p>双圆代表双黑节点</p>
<p>黑方形代表根是黑色的子树，红方形代表根是红色的子树，虚线方形代表根是黑色或者红色的子树。其中子树可能是(NIL)，可能只有一个节点，也可能有多层。</p>
<p><strong>删除原理：</strong> 首先通过二叉树搜索找到需要删除的节点(cur)，若节点为红色用其某个儿子节点替代即可。若节点为黑色，删除该节点会导致黑色节点数量减一，导致黑色节点数量不再平衡，为了保证删除后仍然黑色平衡，需要借用一个红色节点转移到该子树上变为黑色，这样该子树的黑色节点数量和删除之前是一样的，根据不同的情况，该红色节点可以从<strong>删除节点(cur)的孩子</strong>上，<strong>兄弟节点(b)的子树</strong>上、<strong>父节点(p)以其上面祖辈</strong>这三个地方借用红色。</p>
<p><em>注：其中双黑节点就是删除原节点后黑色高度减一的子树的根，等借一个红节点变为黑色后黑色高度平衡，即可将该双黑节点改为单黑节点（即正常黑色节点）</em></p>
<p>首先通过二叉树搜索找到需要删除的节点(cur)，根据(cur)的孩子节点情况分类：</p>
<ul>
<li>(cur)有两个儿子节点</li>
<li>(cur)有一个儿子节点</li>
<li>(cur)没有儿子节点</li>
</ul>
<h3 id="情况1：-cur-有两个儿子节点"><a href="#情况1：-cur-有两个儿子节点" class="headerlink" title="情况1：(cur)有两个儿子节点"></a><strong>情况1：(cur)有两个儿子节点</strong></h3><p>找到(cur)节点的<strong>前驱节点</strong>或<strong>后继节点</strong>来替代(cur)节点，替代后颜色设置为(cur)节点的颜色，然后继续删除该<strong>前驱节点</strong>或<strong>后继节点</strong>。本文采用后继节点来替代删除节点(cur)</p>
<h3 id="情况2：-cur-有一个儿子节点"><a href="#情况2：-cur-有一个儿子节点" class="headerlink" title="情况2：(cur)有一个儿子节点"></a><strong>情况2：(cur)有一个儿子节点</strong></h3><p>(cur)有一个儿子节点有两种可能：</p>
<h4 id="情况2-1：-cur-是红色-（不存在）"><a href="#情况2-1：-cur-是红色-（不存在）" class="headerlink" title="情况2.1：(cur)是红色 （不存在）"></a><strong>情况2.1：(cur)是红色 （不存在）</strong></h4><p>当(cur)是红色且它有一个儿子节点。若儿子节点是黑色，则黑色数量不平衡；若儿子节点是红色，则两个红色不能为父子。所以该情况不存在。</p>
<h4 id="情况2-2：-cur-是黑色"><a href="#情况2-2：-cur-是黑色" class="headerlink" title="情况2.2：(cur)是黑色"></a><strong>情况2.2：(cur)是黑色</strong></h4><p>当(cur)是黑色且它有一个儿子节点。若儿子节点是黑色，则黑色数量不平衡；若儿子节点是红色，成立。</p>
<p>该情况只有(cur)是黑色，(cur)的一个儿子是红色。因为自己的儿子就是红色，可以像自己的儿子借红色节点。</p>
<p>算法：</p>
<ol>
<li>将(cur)节点的<strong>红色儿子</strong>替代(cur)节点。即(p)节点的儿子换为(cur)节点的<strong>红色儿子</strong>（如果(p)存在）</li>
<li>将(cur)节点红色儿子的颜色改为(cur)的颜色，即黑色</li>
</ol>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511164052174.png" alt="image-20250511164052174"></p>
<h3 id="情况3：-cur-没有儿子节点"><a href="#情况3：-cur-没有儿子节点" class="headerlink" title="情况3：(cur)没有儿子节点"></a><strong>情况3：(cur)没有儿子节点</strong></h3><p>(cur)没有儿子节点分为两种情况：</p>
<h4 id="情况3-1：-cur-是红色"><a href="#情况3-1：-cur-是红色" class="headerlink" title="情况3.1：(cur)是红色"></a><strong>情况3.1：(cur)是红色</strong></h4><p>(cur)是红色且没有儿子节点，直接删除该节点用(NIL)替代即可。因为删除红色节点并不会影响黑色平衡。</p>
<p>算法：</p>
<ol>
<li>用(NIL)节点替代(cur)节点，即(p)节点的儿子换为(cur)节点的(NIL)节点（如果(p)存在）</li>
</ol>
<img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511170746244.png" alt="image-20250511170746244" style="zoom:80%;" />

<h4 id="情况3-2：-cur-是黑色"><a href="#情况3-2：-cur-是黑色" class="headerlink" title="情况3.2：(cur)是黑色"></a><strong>情况3.2：(cur)是黑色</strong></h4><p>(cur)是黑色，删除后会导致(cur)锁在的原子树黑色高度减一，所以需要借红色节点变为黑色来补齐黑色高度，而(cur)没有孩子节点，此时需要向兄弟节点或者父亲节点来借。</p>
<h5 id="情况3-2-1：-cur-的兄弟节点-b-是黑色，且-b-的外节点儿子是红色"><a href="#情况3-2-1：-cur-的兄弟节点-b-是黑色，且-b-的外节点儿子是红色" class="headerlink" title="情况3.2.1：(cur)的兄弟节点(b)是黑色，且(b)的外节点儿子是红色"></a><strong>情况3.2.1：(cur)的兄弟节点(b)是黑色，且(b)的外节点儿子是红色</strong></h5><p><strong>当(cur)是(p)的左儿子，(b)为(p)的右儿子</strong></p>
<p>算法：</p>
<ol>
<li>对兄弟节点(b)左旋</li>
<li>重新着色：(br)设置为黑色，(b)设置为(p)的颜色，(p)设置为黑色</li>
<li>删除(cur)节点，用(NIL)替代；若是递归过程中，(cur)节点已经替代过了，不需要操作，以双黑的话术是一开始即用**(NIL)<strong>或</strong>(cur)自身**替代(cur)形成双黑节点，此时将双黑节点变为单黑（即正常的黑色节点）</li>
</ol>
<p>完成操作后，以(b)为根节点的子树黑色平衡且高度与原来一致，结束平衡过程。</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511184757521.png" alt="image-20250511184757521"></p>
<p><strong>当(cur)是(p)的右儿子，(b)为(p)的左儿子</strong></p>
<p>算法：</p>
<ol>
<li>对兄弟节点(b)右旋转</li>
<li>重新着色：(bl)设置为黑色，(b)设置为(p)的颜色，(p)设置为黑色</li>
<li>删除(cur)节点，用(NIL)替代；若是递归过程中，(cur)节点已经替代过了，不需要操作，以双黑的话术是一开始即用**(NIL)<strong>或</strong>(cur)自身**替代(cur)形成双黑节点，此时将双黑节点变为单黑（即正常的黑色节点）</li>
</ol>
<p>完成操作后，以(b)为根节点的子树<strong>黑色平衡</strong>且<strong>黑色高度与原来一致</strong>且**(b)的颜色与原来根节点(p)颜色相同**，结束平衡过程。</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511184808148.png" alt="image-20250511184808148"></p>
<h5 id="情况3-2-2：-cur-的兄弟节点-b-是黑色，且-b-的内节点儿子是红色（其外节点儿子是黑色）"><a href="#情况3-2-2：-cur-的兄弟节点-b-是黑色，且-b-的内节点儿子是红色（其外节点儿子是黑色）" class="headerlink" title="情况3.2.2：(cur)的兄弟节点(b)是黑色，且(b)的内节点儿子是红色（其外节点儿子是黑色）"></a><strong>情况3.2.2：(cur)的兄弟节点(b)是黑色，且(b)的内节点儿子是红色（其外节点儿子是黑色）</strong></h5><p><strong>当(cur)是(p)的左儿子，(b)为(p)的右儿子</strong></p>
<p>算法：</p>
<ol>
<li>对(bl)节点进行右旋</li>
<li>再对(bl)节点进行左旋</li>
<li>重新着色：(bl)设置为(p)的颜色，(p)设置为黑色</li>
<li>删除(cur)节点，用(NIL)替代；若是递归过程中，(cur)节点已经替代过了，不需要操作，以双黑的话术是一开始即用**(NIL)<strong>或</strong>(cur)自身**替代(cur)形成双黑节点，此时将双黑节点变为单黑（即正常的黑色节点）</li>
</ol>
<p>完成操作后，以(bl)为根节点的子树<strong>黑色平衡</strong>且<strong>黑色高度与原来一致</strong>且**(bl)的颜色与原来根节点(p)颜色相同**，结束平衡过程。</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511202439661.png" alt="image-20250511202439661"></p>
<p><strong>当(cur)是(p)的右儿子，(b)为(p)的左儿子</strong></p>
<p>算法：</p>
<ol>
<li>对(br)节点进行左旋</li>
<li>再对(br)节点进行右旋</li>
<li>重新着色：(br)设置为(p)的颜色，(p)设置为黑色</li>
<li>删除(cur)节点，用(NIL)替代；若是递归过程中，(cur)节点已经替代过了，不需要操作，以双黑的话术是一开始即用**(NIL)<strong>或</strong>(cur)自身**替代(cur)形成双黑节点，此时将双黑节点变为单黑（即正常的黑色节点）</li>
</ol>
<p>完成操作后，以(br)为根节点的子树<strong>黑色平衡</strong>且<strong>黑色高度与原来一致</strong>且**(br)的颜色与原来根节点(p)颜色相同**，结束平衡过程。</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511202455584.png" alt="image-20250511202455584"></p>
<h5 id="情况3-2-3：-cur-的兄弟节点-b-是黑色，且-b-的两个儿子都是黑色"><a href="#情况3-2-3：-cur-的兄弟节点-b-是黑色，且-b-的两个儿子都是黑色" class="headerlink" title="情况3.2.3：(cur)的兄弟节点(b)是黑色，且(b)的两个儿子都是黑色"></a><strong>情况3.2.3：(cur)的兄弟节点(b)是黑色，且(b)的两个儿子都是黑色</strong></h5><p>该情况下，(b) (bl) (br) (cur)均为黑色</p>
<h6 id="情况3-2-3-1-父节点-p-为红色"><a href="#情况3-2-3-1-父节点-p-为红色" class="headerlink" title="情况3.2.3.1: 父节点(p)为红色"></a><strong>情况3.2.3.1: 父节点(p)为红色</strong></h6><p>算法：</p>
<ol>
<li>重新着色：(p)设置为黑色，(b)设置为红色</li>
<li>删除(cur)节点，用(NIL)替代；若是递归过程中，(cur)节点已经替代过了，不需要操作，以双黑的话术是一开始即用**(NIL)<strong>或</strong>(cur)自身**替代(cur)形成双黑节点，此时将双黑节点变为单黑（即正常的黑色节点）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511205342926.png" alt="image-20250511205342926"></p>
<p>完成操作后，以(p)为根节点的子树<strong>黑色平衡</strong>且<strong>黑色高度与原来一致</strong>且(p)为黑色不会与其父节点冲突，结束平衡过程。</p>
<h6 id="情况3-2-3-2-父节点-p-为黑色"><a href="#情况3-2-3-2-父节点-p-为黑色" class="headerlink" title="情况3.2.3.2: 父节点(p)为黑色"></a><strong>情况3.2.3.2: 父节点(p)为黑色</strong></h6><p>算法：</p>
<ol>
<li>重新着色：(b)设置为红色</li>
<li>删除(cur)节点，用(NIL)替代；若是递归过程中，(cur)节点已经替代过了，不需要操作，以双黑的话术是一开始即用**(NIL)<strong>或</strong>(cur)自身**替代(cur)形成双黑节点，此时将双黑节点变为单黑（即正常的黑色节点）</li>
<li>将(p)设为双黑节点，递归向上继续平衡(p)，向上平衡过程中需要以下图规定的顺序进行判断，若都不满足需要将(p)的父节点设为双黑，继续向上平衡。若(b)为根节点，即(p)为NULL，终止递归。</li>
</ol>
<p>完成操作后，以(p)为根节点的子树<strong>黑色平衡</strong> 但 <strong>黑色高度减少了一</strong>，所以需要继续向上平衡(p)节点。此时可以将以(p)为根节点的子树看作一个整体，在以(pp)为根节点的子树中平衡，如果以(pp)为根节点的子树仍然不能平衡，就继续向上迭代，直至整棵树的根节点结束。</p>
<p><strong>递归判断顺序：</strong></p>
<ol>
<li>(bb)为黑色且(bbr)为红色</li>
<li>(bb)为黑色且(bbl)为红色</li>
<li>(bb)为红色</li>
<li>(bb)为黑色且(bbl)和(bbr)均为黑色且(pp)为红色</li>
</ol>
<p>若上述条件都不满足即出现了**(bb)为黑色且(bbl)和(bbr)均为黑色且(pp)为黑色**，这时需要继续平衡(pp)节点，即将(pp)设置为双黑节点，继续向上递归。一直递归到(pp)节点为NULL</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511211440827.png" alt="image-20250511211440827"></p>
<h5 id="情况3-2-4：-cur-的兄弟节点-b-是红色"><a href="#情况3-2-4：-cur-的兄弟节点-b-是红色" class="headerlink" title="情况3.2.4：(cur)的兄弟节点(b)是红色"></a><strong>情况3.2.4：(cur)的兄弟节点(b)是红色</strong></h5><p>该情况下(p)一定是黑色，(bl)和(br)一定是黑色</p>
<p><strong>当(cur)是(p)的左儿子，(b)为(p)的右儿子</strong></p>
<p>算法：</p>
<ol>
<li>对(b)进行左旋</li>
<li>重新着色：(b)设置为黑色，(p)设置为红色</li>
<li>平衡以(p)为根节点的子树，继续平衡(cur)，此时变为了兄弟节点是黑色的情况。平衡结束即全部结束</li>
</ol>
<p>在以(p)为根节点的子树中，可能出现三种情况：</p>
<ul>
<li>(blr)是红色，执行<strong>情况3.2.1：(cur)的兄弟节点(b)是黑色，且(b)的外节点儿子是红色</strong></li>
<li>(bll)是红色且(blr)是黑色，执行<strong>情况3.2.2：(cur)的兄弟节点(b)是黑色，且(b)的内节点儿子是红色（其外节点儿子是黑色）</strong></li>
<li>(bll)是黑色且(blr)是黑色，执行<strong>情况3.2.3：(cur)的兄弟节点(b)是黑色，且(b)的儿子都是黑色）</strong> 中 <strong>(p)为红色</strong> 的情况</li>
</ul>
<p>这三种情况都是可以完成平衡的，不需要递归。</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511231147168.png" alt="image-20250511231147168"></p>
<p><strong>当(cur)是(p)的右儿子，(b)为(p)的左儿子</strong></p>
<p>算法：</p>
<ol>
<li>对(b)进行右旋</li>
<li>重新着色：(b)设置为黑色，(p)设置为红色</li>
<li>平衡以(p)为根节点的子树，继续平衡(cur)，此时变为了兄弟节点是黑色的情况。平衡结束即全部结束</li>
</ol>
<p>在以(p)为根节点的子树中，可能出现三种情况：</p>
<ul>
<li>(brl)是红色，执行<strong>情况3.2.1：(cur)的兄弟节点(b)是黑色，且(b)的外节点儿子是红色</strong></li>
<li>(brr)是红色且(brl)是黑色，执行<strong>情况3.2.2：(cur)的兄弟节点(b)是黑色，且(b)的内节点儿子是红色（其外节点儿子是黑色）</strong></li>
<li>(brl)是黑色且(brr)是黑色，执行<strong>情况3.2.3：(cur)的兄弟节点(b)是黑色，且(b)的儿子都是黑色）</strong> 中 <strong>(p)为红色</strong> 的情况</li>
</ul>
<p>这三种情况都是可以完成平衡的，不需要递归。</p>
<p><img src="https://raw.githubusercontent.com/caohongchuan/blogimg/main/nextimg/image-20250511231157008.png" alt="image-20250511231157008"></p>
<h5 id="情况3-2-5：-cur-的兄弟节点-b-是-NIL-（不存在）"><a href="#情况3-2-5：-cur-的兄弟节点-b-是-NIL-（不存在）" class="headerlink" title="情况3.2.5：(cur)的兄弟节点(b)是(NIL) （不存在）"></a><strong>情况3.2.5：(cur)的兄弟节点(b)是(NIL) （不存在）</strong></h5><p>因为(cur)是黑色，若兄弟节点(b)是(NIL)，则黑色数量不平衡，不存在。</p>
<hr>
<h3 id="删除总结"><a href="#删除总结" class="headerlink" title="删除总结"></a>删除总结</h3><p>至此所有的删除情况都讨论完了。目前规定一下在代码中的<strong>情况3.2：(cur)没有子节点是黑色</strong>的判断顺序：</p>
<ol>
<li><strong>情况3.2.1：(cur)的兄弟节点(b)是黑色，且(b)的外节点儿子是红色</strong> [可完成平衡]</li>
<li><strong>情况3.2.2：(cur)的兄弟节点(b)是黑色，且(b)的内节点儿子是红色（其外节点儿子是黑色）</strong> [可完成平衡]</li>
<li><strong>情况3.2.4：(cur)的兄弟节点(b)是红色</strong> [可完成平衡]</li>
<li><strong>情况3.2.3：(cur)的兄弟节点(b)是黑色，且(b)的两个儿子都是黑色</strong> 中的 **情况3.2.3.1: 父节点(p)为红色 **[可完成平衡]</li>
<li><strong>情况3.2.3：(cur)的兄弟节点(b)是黑色，且(b)的两个儿子都是黑色</strong> 中的 <strong>情况3.2.3.2: 父节点(p)为黑色</strong> [需向上递归完成平衡]</li>
</ol>
<p>所有的情况中只有<strong>情况3.2.3：(cur)的兄弟节点(b)是黑色，且(b)的两个儿子都是黑色</strong> 中的 <strong>情况3.2.3.2: 父节点(p)为黑色</strong>是需要向上递归完成平衡的。<strong>情况3.2.4：(cur)的兄弟节点(b)是红色</strong> 只需要转化为 <strong>情况3.2：(cur)没有子节点是黑色</strong> 中的 <strong>情况3.2.1</strong> 或 <strong>情况3.2.2</strong> 或 <strong>情况3.2.3</strong>中的一种，都可直接完成平衡操作。</p>
<p><strong>情况3.2：(cur)没有子节点是黑色</strong>的总结：</p>
<ul>
<li><p><strong>兄弟节点为红色</strong>：通过旋转和颜色交换，转化为黑色兄弟节点的情况。</p>
</li>
<li><p><strong>兄弟节点为黑色</strong>：</p>
<ul>
<li><p>两个子节点均为黑色：将兄弟设为红色，传播双黑或利用红色父节点解决。</p>
</li>
<li><p>远子节点为红色：通过单次旋转和颜色调整消除双黑。</p>
</li>
<li><p>近子节点为红色：通过两次旋转和颜色调整消除双黑。</p>
</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://caohongchuan.github.io/2025/03/29/interview/Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/photo.png">
      <meta itemprop="name" content="YingZheng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yingzheng">
      <meta itemprop="description" content="Programmer of Java and JavaScript. Programming with Springboot, Electron and React-Native.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | yingzheng">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/29/interview/Nginx/" class="post-title-link" itemprop="url">Nginx 面试合集</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-03-29 17:33:08" itemprop="dateCreated datePublished" datetime="2025-03-29T17:33:08+08:00">2025-03-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-03-30 20:26:08" itemprop="dateModified" datetime="2025-03-30T20:26:08+08:00">2025-03-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install nginx</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> systemctl start nginx</span><br><span class="line"><span class="built_in">sudo</span> systemctl stop nginx</span><br><span class="line"></span><br><span class="line"><span class="comment">#平滑启动，不会中断</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl reload nginx</span><br><span class="line"><span class="comment">#完全重启，会中断</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart nginx</span><br><span class="line"><span class="comment"># 状态</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl status nginx</span><br><span class="line"><span class="comment"># 开机自启动</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> nginx</span><br><span class="line"><span class="comment"># 关闭开机启动</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">disable</span> nginx</span><br><span class="line"></span><br><span class="line">ps aux | grep nginx</span><br></pre></td></tr></table></figure>

<h1 id="1-什么是Nginx"><a href="#1-什么是Nginx" class="headerlink" title="1. 什么是Nginx"></a>1. 什么是Nginx</h1><p><a target="_blank" rel="noopener" href="https://nginx.org/">Nginx</a> 是一个高性能的<strong>HTTP服务器</strong>和<strong>反向代理服务器</strong>，它以<strong>轻量级</strong>和<strong>高并发</strong>处理能力而闻名。Nginx 的核心是基于<strong>事件驱动架构</strong>，这使得它在处理大量并发连接时表现出色。它的设计不像传统的服务器那样使用线程处理请求，而是一个更加高级的机制—事件驱动机制，是一种异步事件驱动结构。此外，Nginx 还提供了邮件代理、TCP&#x2F;UDP 代理服务器的功能，以及强大的<strong>负载均衡</strong>和<strong>缓存机制</strong>。它的模块化设计也使得它能够灵活地适应不同的应用场景。</p>
<p>Nginx 的<strong>反向代理</strong>功能允许它作为前端服务器，接收客户端的请求并将它们转发到后端服务器，同时，Nginx 也能够作为<strong>负载均衡</strong>器，将流量分配到多个后端服务器，这样可以提高网站的可用性和扩展性。Nginx 还支持<strong>静态文件服务</strong>，由于其高效的文件处理能力，它经常被用来作为静态资源的服务器。</p>
<h1 id="2-Nginx优点"><a href="#2-Nginx优点" class="headerlink" title="2.Nginx优点"></a>2.Nginx优点</h1><ul>
<li><strong>高性能和高并发</strong>：Nginx 能够处理大量的并发连接，而内存消耗相对较小。这使得它成为处理高流量网站的理想选择。</li>
<li><strong>高可靠性</strong>： Nginx有健康监听机制，当某服务器损坏后，可自动将请求转移到其他正常的服务器。</li>
<li><strong>内存消耗小</strong>：与其他服务器相比，Nginx 在开启多个进程时，内存消耗仍然很低，这对于资源有限的环境非常有用。</li>
<li>静态文件处理：Nginx 在处理静态文件方面非常高效，它能够快速地提供图片、CSS、JavaScript 等静态资源。</li>
<li><strong>反向代理 负载均衡</strong>：Nginx 可以作为负载均衡器，将流量分配到多个后端服务器，这样可以提高网站的可用性和扩展性。</li>
<li>模块化和灵活性：Nginx 的模块化设计使得它能够灵活地适应不同的应用场景，如作为邮件代理、通用 TCP&#x2F;UDP 代理服务器等。</li>
<li>安全性：Nginx 提供了多种安全特性，如防止 DDoS 攻击、限制请求频率等，这有助于提高网站的安全性。</li>
</ul>
<p>缺点：<strong>动态处理能力</strong>：Nginx 在处理动态内容方面相对较弱，它更适合作为静态资源的服务器和反向代理。对于需要复杂动态处理的应用，可能需要与其他应用服务器（如 PHP、Node.js）配合使用。</p>
<h1 id="3-Nginx性能高的原因"><a href="#3-Nginx性能高的原因" class="headerlink" title="3. Nginx性能高的原因"></a>3. Nginx性能高的原因</h1><ul>
<li>异步非阻塞事件处理机制：Nginx 使用了 <strong>epoll</strong>（在 Linux 上）模型，这是一种异步非阻塞的事件处理机制，它可以有效地处理大量的并发连接，而不会因为等待 I&#x2F;O 操作而阻塞。</li>
<li>轻量级进程&#x2F;线程模型：Nginx 使用了轻量级的进程&#x2F;线程模型，这使得它能够在有限的系统资源下处理大量的并发连接。</li>
<li>高效的内存管理：Nginx 在内存管理上非常高效，它使用了自己的内存分配器，这减少了内存碎片和内存泄露的风险。</li>
<li>模块化设计：Nginx 的模块化设计使得它能够灵活地添加或移除功能，这样可以确保只有需要的功能被加载，从而减少了资源的消耗。</li>
<li>静态文件处理优化：Nginx 对静态文件的处理进行了优化，它能够快速地提供静态资源，而不需要后端服务器的参与。</li>
</ul>
<h1 id="4-Nginx如何处理请求"><a href="#4-Nginx如何处理请求" class="headerlink" title="4. Nginx如何处理请求"></a>4. Nginx如何处理请求</h1><ol>
<li><p><strong>接收请求</strong>: 当客户端发起一个请求时，Nginx 的工作进程会监听网络端口，接收客户端的连接请求。</p>
</li>
<li><p><strong>建立连接</strong>: Nginx 接收到客户端的连接请求后，会为该连接分配一个连接对象（ngx_connection_t）。连接对象包含连接的状态信息、读写事件处理器等。</p>
</li>
<li><p><strong>读取请求头</strong>: Nginx 从客户端读取请求头信息。请求头包含 HTTP 方法（如 GET POST）、URL HTTP 版本以及各种请求头字段（如 Host User-Agent Content-Length 等）。</p>
</li>
<li><p><strong>解析请求头</strong>: Nginx 解析请求头信息，提取必要的参数，如请求方法、URI Host 等。解析后的请求头信息存储在 ngx_http_request_t 结构体中。</p>
</li>
<li><p><strong>查找匹配的 server 块</strong>: Nginx 根据请求头中的 Host 字段查找匹配的虚拟主机（server 块）。每个虚拟主机可以配置不同的域名和监听端口。</p>
</li>
<li><p><strong>查找匹配的 location 块</strong>: 在找到匹配的虚拟主机后，Nginx 继续查找与请求 URI 匹配的 location 块。location 块定义了如何处理特定路径的请求。</p>
</li>
<li><p><strong>执行处理阶段</strong>: Nginx 的请求处理分为多个阶段，每个阶段可以由多个模块处理。这些阶段包括但不限于：</p>
</li>
</ol>
<ul>
<li><p>rewrite phase：执行重写规则，如 URL 重写。</p>
</li>
<li><p>post rewrite phase：处理重写后的请求。</p>
</li>
<li><p>preaccess phase：执行访问控制，如 IP 地址过滤。</p>
</li>
<li><p>access phase：执行访问控制，如身份验证。</p>
</li>
<li><p>content phase：生成响应内容，如静态文件服务、反向代理、FastCGI 等。</p>
</li>
</ul>
<ol start="8">
<li><p><strong>生成响应</strong>: 在 content phase 阶段，Nginx 根据配置生成响应内容。这可能涉及读取静态文件、调用后端服务（如反向代理、FastCGI、uWSGI 等）、生成动态内容等。</p>
</li>
<li><p><strong>发送响应头</strong>: Nginx 将生成的响应头发送回客户端。响应头包含 HTTP 状态码、响应头字段（如 Content-Type、Content-Length 等）。</p>
</li>
<li><p><strong>发送响应体</strong>: Nginx 将生成的响应体发送回客户端。响应体可以是静态文件内容、后端服务返回的数据等。</p>
</li>
<li><p><strong>关闭连接</strong>: 一旦响应发送完毕，Nginx 会关闭连接。如果启用了 keep-alive 连接，则连接可以保持打开状态，用于后续请求。</p>
</li>
</ol>
<h1 id="5-正向代理和反向代理"><a href="#5-正向代理和反向代理" class="headerlink" title="5. 正向代理和反向代理"></a>5. 正向代理和反向代理</h1><p><img src="https://img2.baidu.com/it/u=874433948,3077840998&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=518"></p>
<p>都是网络代理服务器：</p>
<ul>
<li><p>正向代理：</p>
<ul>
<li>正向代理位于客户端和目标服务器之间。</li>
<li>客户端通过代理服务器向目标服务器发送请求。</li>
<li>目标服务器只能看到代理服务器的 IP 地址，而看不到客户端的真实 IP 地址。</li>
<li>正向代理通常用于客户端访问互联网时，通过代理服务器来访问外部资源，这可以提高安全性和隐私保护。</li>
</ul>
</li>
<li><p>反向代理：</p>
<ul>
<li><p>反向代理位于客户端和目标服务器之间，但与正向代理不同，客户端通常不知道反向代理的存在。</p>
</li>
<li><p>客户端向反向代理服务器发送请求，然后反向代理服务器将请求转发到一个或多个后端服务器。</p>
</li>
<li><p>后端服务器处理请求并将响应返回给反向代理服务器，反向代理服务器再将响应返回给客户端。</p>
</li>
<li><p>反向代理可以提高网站的可用性和扩展性，同时也可以提供缓存、负载均衡和 SSL 终端等功能。</p>
</li>
<li><p>隐藏服务器：反向代理服务器可以隐藏后端服务器的存在和特征，这有助于提高安全性，因为外部用户无法直接访问后端服务器。<br>负载均衡：反向代理可以作为负载均衡器，将流量分配到多个后端服务器，这样可以提高网站的可用性和扩展性。<br>缓存静态内容：反向代理服务器可以缓存静态内容，如图片、CSS 和 JavaScript 文件等，这样可以减少后端服务器的负载并提高响应速度。<br>SSL 终端：反向代理服务器可以处理 SSL&#x2F;TLS 加密，这样可以减轻后端服务器的加密负担。<br>压缩和优化：反向代理服务器可以在将内容发送到客户端之前对其进行压缩和优化，这样可以减少带宽消耗并提高响应速度。<br>提供额外的安全层：反向代理服务器可以提供额外的安全层，如防火墙、DDoS 防护等。</p>
<p>￼<br>                    版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明。</p>
</li>
</ul>
</li>
</ul>
<h1 id="6-使用“反向代理服务器”的优点"><a href="#6-使用“反向代理服务器”的优点" class="headerlink" title="6. 使用“反向代理服务器”的优点"></a>6. 使用“反向代理服务器”的优点</h1><ul>
<li><p>隐藏服务器：反向代理服务器可以隐藏后端服务器的存在和特征，这有助于提高安全性，因为外部用户无法直接访问后端服务器。</p>
</li>
<li><p>负载均衡：反向代理可以作为负载均衡器，将流量分配到多个后端服务器，这样可以提高网站的可用性和扩展性。</p>
</li>
<li><p>缓存静态内容：反向代理服务器可以缓存静态内容，如图片、CSS 和 JavaScript 文件等，这样可以减少后端服务器的负载并提高响应速度。</p>
</li>
<li><p>SSL 终端：反向代理服务器可以处理 SSL&#x2F;TLS 加密，这样可以减轻后端服务器的加密负担。<br>压缩和优化：反向代理服务器可以在将内容发送到客户端之前对其进行压缩和优化，这样可以</p>
<p>减少带宽消耗并提高响应速度。</p>
</li>
<li><p>提供额外的安全层：反向代理服务器可以提供额外的安全层，如防火墙、DDoS 防护等。</p>
</li>
</ul>
<h1 id="7-Nginx应用场景"><a href="#7-Nginx应用场景" class="headerlink" title="7. Nginx应用场景"></a>7. Nginx应用场景</h1><ul>
<li><p>HTTP 服务器：Nginx 可以作为 HTTP 服务器独立提供 HTTP 服务，适用于静态网站托管。</p>
</li>
<li><p>虚拟主机：Nginx 支持虚拟主机功能，可以在一台服务器上托管多个网站，这对于托管提供商来说非常有用。</p>
</li>
<li><p>反向代理和负载均衡：Nginx 可以作为反向代理服务器，将请求转发到后端服务器，并支持负载均衡，这对于高流量网站和应用来说非常重要。</p>
</li>
<li><p>API 网关：Nginx 可以配置为 API 网关，对每个接口服务进行拦截和路由，提供额外的安全层和流量控制。</p>
</li>
<li><p>媒体流服务：Nginx 支持媒体流服务，可以用于视频点播和直播服务。</p>
</li>
<li><p>邮件代理：Nginx 还可以作为邮件代理服务器，处理邮件传输。</p>
</li>
<li><p>缓存服务器：Nginx 可以设置为缓存服务器，缓存静态内容和动态内容，减少后端服务器的负载，提高响应速度。</p>
</li>
<li><p>SSL 终端：Nginx 可以处理 SSL&#x2F;TLS 加密，提供 HTTPS 服务，增强数据传输的安全性。</p>
</li>
</ul>
<h1 id="8-Nginx目录结构"><a href="#8-Nginx目录结构" class="headerlink" title="8. Nginx目录结构"></a>8. Nginx目录结构</h1><p>client_body_temp：用于存储客户端请求的临时文件。<br>conf：存放 Nginx 的配置文件，包括 nginx.conf 主配置文件和其他配置文件。<br>fastcgi_temp：用于存储 FastCGI 进程的临时文件。<br>html：默认的站点目录，通常用于存放静态文件，如 HTML、CSS、JavaScript 文件等。<br>logs：存放 Nginx 的日志文件，包括访问日志 access.log、错误日志 error.log 和进程 ID 文件 nginx.pid。<br>proxy_temp：用于存储代理服务器的临时文件。<br>sbin：存放 Nginx 的可执行文件，如 nginx 命令。<br>scgi_temp：用于存储 SCGI 进程的临时文件。<br>uwsgi_temp：用于存储 uWSGI 进程的临时文件。</p>
<h1 id="9-Nginx配置文件nginx-conf有哪些属性模块"><a href="#9-Nginx配置文件nginx-conf有哪些属性模块" class="headerlink" title="9. Nginx配置文件nginx.conf有哪些属性模块"></a>9. Nginx配置文件nginx.conf有哪些属性模块</h1><ul>
<li><p>http：定义了 HTTP 服务器的配置，包括文件类型、默认类型、连接超时等。</p>
</li>
<li><p>server：定义了虚拟主机的配置，可以包含多个 server 块，每个块定义了一个虚拟主机的设置。</p>
</li>
<li><p>location：定义了请求的匹配和处理规则，可以根据 URI、正则表达式等匹配请求，并指定处理方式。</p>
</li>
<li><p>upstream：定义了负载均衡的配置，可以指定多个后端服务器，并设置负载均衡策略。</p>
</li>
<li><p>events：定义了事件处理的配置，如工作连接数 worker_connections。</p>
</li>
<li><p>mail：如果 Nginx 用于邮件代理，这个模块用于配置邮件服务的相关参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">全局模块</span><br><span class="line">event模块</span><br><span class="line">http模块</span><br><span class="line">    upstream模块</span><br><span class="line"></span><br><span class="line">    server模块</span><br><span class="line">        location块</span><br><span class="line">        location块</span><br><span class="line">        ....</span><br><span class="line">    server模块</span><br><span class="line">        location块</span><br><span class="line">        location块</span><br><span class="line">        ...</span><br><span class="line">    ....    </span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="10-静态文件服务"><a href="#10-静态文件服务" class="headerlink" title="10. 静态文件服务"></a>10. 静态文件服务</h1><p>Nginx 在处理静态文件（如 HTML、CSS、JavaScript 和图像文件）时非常高效。它可以直接从文件系统中读取静态文件并返回给客户端，而不需要经过复杂的处理流程。</p>
<ul>
<li>root 指令：指定文件系统上的根目录，用于查找静态资源。</li>
<li>alias 指令：为静态资源定义一个别名，方便管理和引用。</li>
<li>autoindex 指令：当请求的 URI 以斜杠 &#x2F; 结尾时，启用目录索引功能，列出目录下的所有文件。</li>
<li>sendfile 指令：开启高效传输模式，允许 Nginx 直接在内核空间将文件发送给客户端，提高文件传输效率。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">	server &#123;</span><br><span class="line">	    listen 8081;</span><br><span class="line">	    server_name localhost;</span><br><span class="line">	    root /home/amber/Downloads/photo;</span><br><span class="line">	    autoindex on; # 启用目录列表</span><br><span class="line">	    location / &#123;</span><br><span class="line">			try_files $uri $uri/ =404;</span><br><span class="line">	    &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="11-如何用Nginx解决前端跨域问题"><a href="#11-如何用Nginx解决前端跨域问题" class="headerlink" title="11. 如何用Nginx解决前端跨域问题"></a>11. 如何用Nginx解决前端跨域问题</h1><p>Nginx 可以通过配置 CORS（跨源资源共享）头部来解决前端跨域问题。</p>
<p>在 server 或 location 块中，使用 add_header 指令添加 Access-Control-Allow-Origin 头部，指定允许访问的源。如果需要，还可以添加 Access-Control-Allow-Methods 头部，指定允许的 HTTP 方法。对于需要凭证的请求，可以添加 Access-Control-Allow-Credentials 头部。</p>
<blockquote>
<p>产生跨域问题的主要原因就在于<strong>同源策略</strong>，为了保证用户信息安全，防止恶意网站窃取数据，同源策略是必须的，否则<code>cookie</code>可以共享。由于<code>http</code>无状态协议通常会借助<code>cookie</code>来实现有状态的信息记录，例如用户的身份&#x2F;密码等，因此一旦<code>cookie</code>被共享，那么会导致用户的身份信息被盗取。<br>同源策略主要是指三点相同，<strong>协议+域名+端口</strong> 相同的两个请求，则可以被看做是同源的，但如果其中任意一点存在不同，则代表是两个不同源的请求，同源策略会限制了不同源之间的资源交互。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    # 允许跨域的请求，可以自定义变量$http_origin，*表示所有</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Origin&#x27; *;</span><br><span class="line">    # 允许携带cookie请求</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;</span><br><span class="line">    # 允许跨域请求的方法：GET,POST,OPTIONS,PUT</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET,POST,OPTIONS,PUT&#x27;;</span><br><span class="line">    # 允许请求时携带的头部信息，*表示所有</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Headers&#x27; *;</span><br><span class="line">    # 允许发送按段获取资源的请求</span><br><span class="line">    add_header &#x27;Access-Control-Expose-Headers&#x27; &#x27;Content-Length,Content-Range&#x27;;</span><br><span class="line">    # 一定要有！！！否则Post请求无法进行跨域！</span><br><span class="line">    # 在发送Post跨域请求前，会以Options方式发送预检请求，服务器接受时才会正式请求</span><br><span class="line">    if ($request_method = &#x27;OPTIONS&#x27;) &#123;</span><br><span class="line">        add_header &#x27;Access-Control-Max-Age&#x27; 1728000;</span><br><span class="line">        add_header &#x27;Content-Type&#x27; &#x27;text/plain; charset=utf-8&#x27;;</span><br><span class="line">        add_header &#x27;Content-Length&#x27; 0;</span><br><span class="line">        # 对于Options方式的请求返回204，表示接受跨域请求</span><br><span class="line">        return 204;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="12-Nginx虚拟主机怎么配置"><a href="#12-Nginx虚拟主机怎么配置" class="headerlink" title="12. Nginx虚拟主机怎么配置"></a>12. Nginx虚拟主机怎么配置</h1><p>在 Nginx 中配置虚拟主机主要涉及 <code>server</code> 块的设置。</p>
<ul>
<li>定义 server 块：每个 server 块定义了一个虚拟主机的配置。</li>
<li>设置监听端口：使用 listen 指令设置服务器监听的端口，通常是 80（HTTP）和 443（HTTPS）。</li>
<li>设置服务器名称：使用 server_name 指令设置虚拟主机的域名。</li>
<li>定义 location 块：在 server 块内部定义 location 块，设置请求的处理规则。</li>
<li>设置根目录：使用 root 指令设置网站内容的根目录。</li>
<li>设置默认首页：使用 index 指令设置默认首页文件。</li>
</ul>
<p><code>location</code> 指令在 Nginx 配置中扮演着核心角色，它定义了如何处理进入 Nginx 的 HTTP 请求。location 块可以匹配不同的 URI、正则表达式或指定的字符串，从而允许对特定的请求路径应用不同的处理规则。</p>
<ul>
<li>精确匹配：使用 &#x3D; 符号进行精确匹配，例如 location &#x3D; &#x2F; 匹配根路径。</li>
<li>字符串开头匹配：使用 ^~ 符号匹配以特定字符串开头的 URI。</li>
<li>正则表达式匹配：使用 ~ 或 ~* 符号进行正则表达式匹配，其中 ~ 是区分大小写的，而 ~* 是不区分大小写的。</li>
<li>通用匹配（前缀匹配）：使用 &#x2F; 符号进行通用匹配，作为最后的选择，如果其他匹配都未成功，请求将被这个 location 块处理。</li>
</ul>
<p>location 块可以包含多种指令，如 proxy_pass root try_files 等，用于定义请求的处理方式，例如代理到后端服务器、提供静态文件服务或重定向。</p>
<h1 id="13-Nginx配置SSL证书"><a href="#13-Nginx配置SSL证书" class="headerlink" title="13. Nginx配置SSL证书"></a>13. Nginx配置SSL证书</h1><p>为了缓解后端服务器的压力，加密解密一般都放置在Nginx反向代理中，而后端服务器处于局域网内，不需要加密传输。</p>
<ol>
<li><p>先去CA机构或从云控制台中申请对应的<code>SSL</code>证书，审核通过后下载<code>Nginx</code>版本的证书。</p>
</li>
<li><p>下载数字证书后，完整的文件总共有三个：<code>.crt .key .pem,</code></p>
<ul>
<li><code>.crt</code>：数字证书文件，<code>.crt</code>是<code>.pem</code>的拓展文件，因此有些人下载后可能没有。&#96;</li>
<li><code>.key</code>：服务器的私钥文件，及非对称加密的私钥，用于解密公钥传输的数据。</li>
<li><code>.pem</code>：<code>Base64-encoded</code>编码格式的源证书文本文件，可自行根需求修改拓展名。</li>
</ul>
</li>
<li><p>在<code>Nginx</code>目录下新建<code>certificate</code>目录，并将下载好的证书&#x2F;私钥等文件上传至该目录。</p>
</li>
<li><p>修改Nginx配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># ----------HTTPS配置-----------</span><br><span class="line">server &#123;</span><br><span class="line">    # 监听HTTPS默认的443端口</span><br><span class="line">    listen 443;</span><br><span class="line">    # 配置自己项目的域名</span><br><span class="line">    server_name www.xxx.com;</span><br><span class="line">    # 打开SSL加密传输</span><br><span class="line">    ssl on;</span><br><span class="line">    # 输入域名后，首页文件所在的目录</span><br><span class="line">    root html;</span><br><span class="line">    # 配置首页的文件名</span><br><span class="line">    index index.html index.htm index.jsp index.ftl;</span><br><span class="line">    # 配置自己下载的数字证书</span><br><span class="line">    ssl_certificate  certificate/xxx.pem;</span><br><span class="line">    # 配置自己下载的服务器私钥</span><br><span class="line">    ssl_certificate_key certificate/xxx.key;</span><br><span class="line">    # 停止通信时，加密会话的有效期，在该时间段内不需要重新交换密钥</span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line">    # TLS握手时，服务器采用的密码套件</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    # 服务器支持的TLS版本</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">    # 开启由服务器决定采用的密码套件</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        ....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ---------HTTP请求转HTTPS-------------</span><br><span class="line">server &#123;</span><br><span class="line">    # 监听HTTP默认的80端口</span><br><span class="line">    listen 80;</span><br><span class="line">    # 如果80端口出现访问该域名的请求</span><br><span class="line">    server_name www.xxx.com;</span><br><span class="line">    # 将请求改写为HTTPS（这里写你配置了HTTPS的域名）</span><br><span class="line">    rewrite ^(.*)$ https://www.xxx.com;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="14-如何配置限流"><a href="#14-如何配置限流" class="headerlink" title="14. 如何配置限流"></a>14. 如何配置限流</h1><p>Nginx 的限流基于令牌桶算法，主要依赖以下指令：</p>
<ul>
<li><strong>limit_req_zone</strong>：定义限流的共享内存区域和限制规则。</li>
<li><strong>limit_req</strong>：在具体的 location 中应用限流规则。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 限制每个 IP 每秒 2 次请求</span><br><span class="line">http &#123;</span><br><span class="line">    limit_req_zone $binary_remote_addr zone=myzone:10m rate=2r/s;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        location / &#123;</span><br><span class="line">        	#允许额外 5 个突发请求，超限请求会被延迟处理</span><br><span class="line">            limit_req zone=myzone burst=5;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果客户端在 1 秒内发送 10 个请求：</p>
<ul>
<li>前 2 个请求立即处理（符合 rate）。</li>
<li>接下来的 5 个请求进入队列（burst 容量）。</li>
<li>剩余 3 个请求被拒绝（桶满）。</li>
<li>队列中的 5 个请求会以每秒 2 个的速率逐步处理。</li>
</ul>
<h1 id="15-漏桶流算法和令牌桶算法"><a href="#15-漏桶流算法和令牌桶算法" class="headerlink" title="15. 漏桶流算法和令牌桶算法"></a>15. 漏桶流算法和令牌桶算法</h1><p>漏桶算法和令牌桶算法是两种常用的流量整形和速率限制算法，它们在网络中用于控制数据的传输速率。</p>
<ul>
<li><p>漏桶算法：<br>漏桶算法通过一个固定容量的桶和漏水龙头来控制数据流。数据以任意速率进入桶中，然后以固定的速率从桶中流出。如果桶满了，额外的数据将被丢弃。这种机制可以平滑突发流量，确保数据以固定的速率被处理，防止网络拥塞。</p>
</li>
<li><p>令牌桶算法：<br>令牌桶算法使用一个令牌桶，桶中会以固定的速率生成令牌。每个数据包的发送需要消耗一个令牌。如果桶中没有令牌，数据包将被延迟发送，直到桶中有令牌可用。这种算法允许数据以峰值速率发送，直到令牌耗尽，然后数据发送速率将降至平均速率。</p>
</li>
</ul>
<p>令牌桶算法更适合需要突发传输的应用，因为它允许在令牌充足时快速发送数据。而漏桶算法则更适合于那些需要持续、均匀速率发送数据的应用。</p>
<h1 id="16-Nginx-动静分离"><a href="#16-Nginx-动静分离" class="headerlink" title="16. Nginx 动静分离"></a>16. Nginx 动静分离</h1><p>动静分离是指将动态内容和静态内容分开处理和存储。</p>
<ul>
<li>性能优化：静态资源如图片 CSS JavaScript 文件等不经常变化，可以由 Nginx 直接提供，这样可以减少后端应用服务器的负载，提高响应速度。</li>
<li>缓存策略：静态资源适合设置较长的缓存时间，而动态内容通常需要实时处理，动静分离后可以针对静态资源设置更有效的缓存策略。</li>
<li>扩展性：在高流量的情况下，可以通过增加静态资源服务器的数量来提高服务能力，而不用担心影响动态内容的处理。</li>
<li>安全性：静态资源通常不需要访问后端数据库或其他安全敏感的服务，将它们与动态内容分离可以减少安全风险。</li>
</ul>
<p>通过动静分离，可以提高网站的整体性能和可扩展性，同时降低运维成本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name example.com;</span><br><span class="line">    </span><br><span class="line">    # 静态资源配置</span><br><span class="line">    location ~ .*\.(html|htm|gif|jpg|jpeg|bmp|png|ico|txt|js|css)&#123;</span><br><span class="line">        root    /xxx/static_resources;</span><br><span class="line">        expires 7d;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    # 动态资源配置</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="17-Nginx负载均衡的算法"><a href="#17-Nginx负载均衡的算法" class="headerlink" title="17. Nginx负载均衡的算法"></a>17. Nginx负载均衡的算法</h1><p>Nginx 实现负载均衡主要通过 upstream 模块，该模块允许定义一个后端服务器组，并根据特定的策略将请求分发到这些服务器。以下是 Nginx 支持的一些负载均衡策略：</p>
<ul>
<li><p>轮询（round-robin）：默认策略，将请求按顺序轮流分配给每个服务器。</p>
</li>
<li><p>权重（weight）：通过给每个服务器设置权重来控制流量分配的比例。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream app1 &#123;</span><br><span class="line">    server 10.10.10.1 weight=3;</span><br><span class="line">    server 10.10.10.2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>IP绑定（ip_hash）：通过请求来源的 IP 地址进行哈希，确保同一 IP 的请求总是被分配到同一个服务器。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream app1 &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 10.10.10.1;</span><br><span class="line">    server 10.10.10.2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>最少连接（least-connected）：每次都找连接数最少的服务器来转发请求。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream app1 &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server 10.10.10.1;</span><br><span class="line">    server 10.10.10.2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server server1 weight=3;</span><br><span class="line">        server server2 weight=2;</span><br><span class="line">        server server3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name example.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="18-Nginx配置高可用性"><a href="#18-Nginx配置高可用性" class="headerlink" title="18. Nginx配置高可用性"></a>18. Nginx配置高可用性</h1><p>配置 Nginx 以实现高可用性主要涉及确保 Nginx 能够处理后端服务器的故障，并在必要时将流量重定向到健康的服务器。</p>
<ul>
<li>定义多个后端服务器：在 upstream 块中定义多个服务器，以便在一个服务器失败时有备用服务器可用。</li>
<li>设置超时参数：配置 proxy_connect_timeout、proxy_send_timeout 和 proxy_read_timeout 指令，以便在后端服务器无响应时及时失败转移。</li>
<li>使用 max_fails 和 fail_timeout：配置 max_fails 指令来设置在多长时间内允许多少次失败，以及 fail_timeout 指令来设置服务器失败后应该被排除在外的时间。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    upstream backend &#123;</span><br><span class="line">        server server1;</span><br><span class="line">        server server2;</span><br><span class="line">        server server3;</span><br><span class="line"></span><br><span class="line">        max_fails=3;</span><br><span class="line">        fail_timeout=30s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name example.com;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_pass http://backend;</span><br><span class="line">            proxy_connect_timeout 1s;</span><br><span class="line">            proxy_send_timeout 1s;</span><br><span class="line">            proxy_read_timeout 1s;</span><br><span class="line">            proxy_next_upstream error timeout invalid_header http_500 http_502 http_503 http_504;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果后端服务器在 30 秒内失败超过 3 次，它将被认为不可用，并从轮询中排除 30 秒。同时，如果 Nginx 遇到超时或指定的 HTTP 状态码，它将尝试将请求代理到另一个健康的服务器</p>
<h1 id="19-限制IP或浏览器访问"><a href="#19-限制IP或浏览器访问" class="headerlink" title="19. 限制IP或浏览器访问"></a>19. 限制IP或浏览器访问</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 只允许Chrome浏览器访问</span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name example.com;</span><br><span class="line">    </span><br><span class="line">    location / &#123;</span><br><span class="line">        if ($http_user_agent ~ Chrome) &#123;</span><br><span class="line">            return 500;</span><br><span class="line">        &#125;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># ------------------------------------------------------</span><br><span class="line"># 只允许192.168.1.100和192.168.1.101访问</span><br><span class="line">geo $block_ip &#123;</span><br><span class="line">    default 0;</span><br><span class="line">    192.168.1.100 1;</span><br><span class="line">    192.168.1.101 1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name example.com;</span><br><span class="line">    </span><br><span class="line">    location / &#123;</span><br><span class="line">        if ($block_ip) &#123;</span><br><span class="line">            return 403;</span><br><span class="line">        &#125;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="20-多进程模型-主进程-和-工作进程"><a href="#20-多进程模型-主进程-和-工作进程" class="headerlink" title="20. 多进程模型 主进程 和 工作进程"></a>20. 多进程模型 主进程 和 工作进程</h1><p>Nginx的多进程模型主要由一个主进程（master process）和多个工作进程（worker process）组成。主进程负责管理和监控工作进程，而工作进程负责处理实际的客户端请求。</p>
<p>每个工作进程都是单线程的，这意味着每个工作进程在同一时间只能处理一个客户端请求。这种设计选择主要基于以下原因：</p>
<ul>
<li>轻量级：单线程模型相对于多线程或多进程模型来说更加轻量级，减少了线程切换和进程间通信的开销。</li>
<li>可扩展性：通过创建多个工作进程，Nginx能够同时处理多个请求，实现高并发处理能力。每个工作进程之间相互独立，可以并行处理请求，提高系统的吞吐量。</li>
<li>高效的事件驱动模型：Nginx使用了高效的事件驱动模型（基于epoll kqueue等），通过异步非阻塞方式处理网络请求，从而避免了线程阻塞和资源浪费。</li>
</ul>
<p>需要注意的是，尽管每个工作进程是单线程的，但Nginx通过事件驱动和非阻塞I&#x2F;O的方式能够处理大量并发请求，实现高性能和高吞吐量。这种设计在处理静态内容和反向代理等场景下表现出色，但在涉及大量计算密集型任务的场景下可能会受到性能限制。在这种情况下，通常会将计算任务委托给后端应用服务器来处理。</p>
<p>当Nginx启动时，它会创建一个主进程（master process），主进程主要负责以下任务：</p>
<ul>
<li>读取并解析配置文件：主进程会读取Nginx的主配置文件（nginx.conf），包括全局配置和默认服务器配置。它还可以包含其他辅助配置文件（如conf.d目录下的文件）。</li>
<li>启动工作进程：主进程会根据配置文件中指定的工作进程数量，创建相应数量的工作进程。每个工作进程都是一个独立的进程，负责实际处理客户端请求。</li>
<li>监控工作进程：主进程会监控工作进程的运行状态，如果工作进程异常退出或终止，主进程会重新启动新的工作进程来替代。</li>
<li>处理信号：主进程可以接收系统信号（如重启、停止等），并根据信号进行相应的操作，例如重新加载配置文件或优雅地关闭工作进程。</li>
</ul>
<p>每个工作进程都是单线程的，每个工作进程通过异步非阻塞方式处理客户端请求。这种事件驱动的模型允许每个工作进程同时处理多个并发请求，而无需为每个请求创建一个新的线程。</p>
<p>工作进程的主要任务包括：</p>
<ul>
<li>接收和处理连接：工作进程通过监听套接字接收客户端的连接请求，并根据配置文件中的服务器块进行请求分发。它会接受请求、解析请求头和请求体，并执行相应的操作。</li>
<li>处理请求：工作进程通过事件驱动模型，使用非阻塞I&#x2F;O方式处理请求。它会执行请求所需的操作，如读取文件、向后端服务器发起代理请求等。</li>
<li>响应客户端：工作进程会生成响应数据，并将响应发送回客户端。它会设置响应头、发送响应体，并根据配置进行内容压缩、缓存等操作。</li>
<li>日志记录：工作进程会将访问日志和错误日志写入相应的日志文件，记录请求的详细信息和错误信息。</li>
</ul>
<p>Nginx的多进程单线程模型结合了事件驱动和非阻塞I&#x2F;O的优势，使得它在高并发场景下能够高效地处理大量的并发请求，同时保持较低的资源消耗。这使得Nginx成为一个流行的高性能Web服务器和反向代理服务器。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">YingZheng</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/caohongchuan" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"caohongchuan","repo":"caohongchuan.github.io","client_id":"967bc44f66d40841715d","client_secret":"8d7caaf8d49e847e9da60bfab064fc2acad2b66d","admin_user":"caohongchuan","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"en | zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"d1546d731a9f30cc80127d57142a482b"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
